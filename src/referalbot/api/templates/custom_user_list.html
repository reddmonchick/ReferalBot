{% extends "sqladmin/list.html" %}
{% block list_table %}
    <table class="table">
        <thead>
            <tr>
                {% for column in view.column_labels %}
                    <th>{{ column }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for model in models %}
                <tr>
                    <td>{{ model.id }}</td>
                    <td>{{ model.telegram_id }}</td>
                    <td>{{ model.username }}</td>
                    <td>{{ model.promo_code }}</td>
                    <td>{{ model.invited_by.username if model.invited_by else '-' }}</td>
                    <td>{{ model.created_at }}</td>
                    <td>
                        {% if model.referrals %}
                            {{ model.referrals | map(attribute='username') | map('default', 'User ' ~ model.referrals[loop.index0].id|string) | join(', ') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>                    
                    <td>{{ model.purchases | map(attribute='name') | join(', ') if model.purchases else "-" }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}