2025-07-19 03:14:32,240 - ERROR - [handlers] Ошибка в обработчике /start с реферальным кодом: list index out of range
2025-07-19 03:14:33,285 - INFO - [dispatcher] Update id=433007647 is handled. Duration 1045 ms by bot id=7524145939
2025-07-19 03:15:44,367 - INFO - [dispatcher] Polling stopped
2025-07-19 03:15:44,371 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:15:44,372 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:15:44,573 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:15:49,082 - INFO - [base] select pg_catalog.version()
2025-07-19 03:15:49,083 - INFO - [base] [raw sql] ()
2025-07-19 03:15:49,084 - INFO - [base] select current_schema()
2025-07-19 03:15:49,085 - INFO - [base] [raw sql] ()
2025-07-19 03:15:49,086 - INFO - [base] show standard_conforming_strings
2025-07-19 03:15:49,086 - INFO - [base] [raw sql] ()
2025-07-19 03:15:49,087 - INFO - [base] BEGIN (implicit)
2025-07-19 03:15:49,091 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:15:49,092 - INFO - [base] [generated in 0.00103s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:15:49,095 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:15:49,097 - INFO - [base] [cached since 0.005382s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:15:49,098 - INFO - [base] COMMIT
2025-07-19 03:15:50,265 - INFO - [dispatcher] Start polling
2025-07-19 03:15:50,523 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:15:52,440 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:15:52,441 - INFO - [base] BEGIN (implicit)
2025-07-19 03:15:52,446 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:15:52,447 - INFO - [base] [generated in 0.00101s] (7912699911,)
2025-07-19 03:15:52,450 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:15:52,451 - INFO - [base] [generated in 0.00088s] ('REF_reddmon1761',)
2025-07-19 03:15:52,453 - INFO - [base] COMMIT
2025-07-19 03:15:53,499 - INFO - [dispatcher] Update id=433007648 is handled. Duration 1062 ms by bot id=7524145939
2025-07-19 03:17:00,992 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-19 03:17:00,992 - INFO - [base] BEGIN (implicit)
2025-07-19 03:17:00,993 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:17:00,993 - INFO - [base] [cached since 68.55s ago] (1758719447,)
2025-07-19 03:17:00,995 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-19 03:17:00,995 - INFO - [base] [generated in 0.00045s] (6,)
2025-07-19 03:17:00,996 - INFO - [base] COMMIT
2025-07-19 03:17:01,274 - INFO - [dispatcher] Update id=433007649 is handled. Duration 281 ms by bot id=7524145939
2025-07-19 03:17:43,297 - INFO - [dispatcher] Polling stopped
2025-07-19 03:17:43,299 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:17:43,299 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:17:43,485 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:17:47,577 - INFO - [base] select pg_catalog.version()
2025-07-19 03:17:47,577 - INFO - [base] [raw sql] ()
2025-07-19 03:17:47,578 - INFO - [base] select current_schema()
2025-07-19 03:17:47,579 - INFO - [base] [raw sql] ()
2025-07-19 03:17:47,580 - INFO - [base] show standard_conforming_strings
2025-07-19 03:17:47,580 - INFO - [base] [raw sql] ()
2025-07-19 03:17:47,581 - INFO - [base] BEGIN (implicit)
2025-07-19 03:17:47,585 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:17:47,586 - INFO - [base] [generated in 0.00080s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:17:47,588 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:17:47,589 - INFO - [base] [cached since 0.003729s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:17:47,590 - INFO - [base] COMMIT
2025-07-19 03:17:48,741 - INFO - [dispatcher] Start polling
2025-07-19 03:17:48,998 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:17:49,259 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:17:49,260 - INFO - [base] BEGIN (implicit)
2025-07-19 03:17:49,265 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:17:49,266 - INFO - [base] [generated in 0.00077s] (7912699911,)
2025-07-19 03:17:49,269 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:17:49,269 - INFO - [base] [generated in 0.00075s] ('REF_reddmon1761',)
2025-07-19 03:17:49,271 - INFO - [base] COMMIT
2025-07-19 03:17:50,313 - INFO - [dispatcher] Update id=433007650 is handled. Duration 1062 ms by bot id=7524145939
2025-07-19 03:18:22,288 - INFO - [dispatcher] Polling stopped
2025-07-19 03:18:22,288 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:18:22,289 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:18:22,455 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:18:26,121 - INFO - [base] select pg_catalog.version()
2025-07-19 03:18:26,121 - INFO - [base] [raw sql] ()
2025-07-19 03:18:26,123 - INFO - [base] select current_schema()
2025-07-19 03:18:26,123 - INFO - [base] [raw sql] ()
2025-07-19 03:18:26,124 - INFO - [base] show standard_conforming_strings
2025-07-19 03:18:26,124 - INFO - [base] [raw sql] ()
2025-07-19 03:18:26,125 - INFO - [base] BEGIN (implicit)
2025-07-19 03:18:26,128 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:18:26,129 - INFO - [base] [generated in 0.00108s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:18:26,131 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:18:26,132 - INFO - [base] [cached since 0.003938s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:18:26,133 - INFO - [base] COMMIT
2025-07-19 03:18:27,079 - INFO - [dispatcher] Start polling
2025-07-19 03:18:27,335 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:18:28,870 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:18:28,872 - INFO - [base] BEGIN (implicit)
2025-07-19 03:18:28,881 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:18:28,889 - INFO - [base] [generated in 0.00814s] (7912699911,)
2025-07-19 03:18:28,893 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:18:28,894 - INFO - [base] [generated in 0.00176s] ('REF_reddmon1761',)
2025-07-19 03:18:28,896 - INFO - [base] COMMIT
2025-07-19 03:18:29,949 - INFO - [dispatcher] Update id=433007651 is handled. Duration 1077 ms by bot id=7524145939
2025-07-19 03:19:17,786 - INFO - [dispatcher] Polling stopped
2025-07-19 03:19:17,787 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:19:17,787 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:19:17,995 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:19:22,175 - INFO - [base] select pg_catalog.version()
2025-07-19 03:19:22,175 - INFO - [base] [raw sql] ()
2025-07-19 03:19:22,177 - INFO - [base] select current_schema()
2025-07-19 03:19:22,177 - INFO - [base] [raw sql] ()
2025-07-19 03:19:22,178 - INFO - [base] show standard_conforming_strings
2025-07-19 03:19:22,178 - INFO - [base] [raw sql] ()
2025-07-19 03:19:22,179 - INFO - [base] BEGIN (implicit)
2025-07-19 03:19:22,182 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:19:22,182 - INFO - [base] [generated in 0.00069s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:19:22,184 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:19:22,185 - INFO - [base] [cached since 0.003262s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:19:22,186 - INFO - [base] COMMIT
2025-07-19 03:19:23,333 - INFO - [dispatcher] Start polling
2025-07-19 03:19:23,590 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:19:26,738 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:19:26,738 - INFO - [base] BEGIN (implicit)
2025-07-19 03:19:26,743 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:19:26,744 - INFO - [base] [generated in 0.00125s] (7912699911,)
2025-07-19 03:19:26,746 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:19:26,747 - INFO - [base] [generated in 0.00064s] ('reddmon1761',)
2025-07-19 03:19:26,750 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-19 03:19:26,750 - INFO - [base] [generated in 0.00055s] (6, 7)
2025-07-19 03:19:26,752 - INFO - [base] COMMIT
2025-07-19 03:19:27,806 - INFO - [dispatcher] Update id=433007652 is handled. Duration 1077 ms by bot id=7524145939
2025-07-19 03:19:32,767 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-19 03:19:32,768 - INFO - [base] BEGIN (implicit)
2025-07-19 03:19:32,768 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:19:32,769 - INFO - [base] [cached since 6.026s ago] (1758719447,)
2025-07-19 03:19:32,770 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-19 03:19:32,771 - INFO - [base] [generated in 0.00056s] (6,)
2025-07-19 03:19:32,773 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-19 03:19:32,773 - INFO - [base] [generated in 0.00062s] (7,)
2025-07-19 03:19:32,775 - INFO - [base] COMMIT
2025-07-19 03:19:33,046 - INFO - [dispatcher] Update id=433007653 is handled. Duration 280 ms by bot id=7524145939
2025-07-19 03:19:40,909 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:19:40,909 - INFO - [base] BEGIN (implicit)
2025-07-19 03:19:40,910 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:19:40,911 - INFO - [base] [cached since 14.17s ago] (7912699911,)
2025-07-19 03:19:40,912 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:19:40,913 - INFO - [base] [cached since 14.17s ago] ('reddmon1761',)
2025-07-19 03:19:40,914 - INFO - [base] COMMIT
2025-07-19 03:19:41,189 - INFO - [dispatcher] Update id=433007654 is handled. Duration 282 ms by bot id=7524145939
2025-07-19 03:19:43,206 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-19 03:19:43,207 - INFO - [base] BEGIN (implicit)
2025-07-19 03:19:43,207 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:19:43,208 - INFO - [base] [cached since 16.46s ago] (1758719447,)
2025-07-19 03:19:43,209 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-19 03:19:43,209 - INFO - [base] [cached since 10.44s ago] (6,)
2025-07-19 03:19:43,211 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-19 03:19:43,211 - INFO - [base] [cached since 10.44s ago] (7,)
2025-07-19 03:19:43,212 - INFO - [base] COMMIT
2025-07-19 03:19:43,483 - INFO - [dispatcher] Update id=433007655 is handled. Duration 282 ms by bot id=7524145939
2025-07-19 03:20:32,001 - INFO - [dispatcher] Polling stopped
2025-07-19 03:20:32,002 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:20:32,003 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:20:32,190 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:20:36,146 - INFO - [base] select pg_catalog.version()
2025-07-19 03:20:36,147 - INFO - [base] [raw sql] ()
2025-07-19 03:20:36,148 - INFO - [base] select current_schema()
2025-07-19 03:20:36,148 - INFO - [base] [raw sql] ()
2025-07-19 03:20:36,149 - INFO - [base] show standard_conforming_strings
2025-07-19 03:20:36,150 - INFO - [base] [raw sql] ()
2025-07-19 03:20:36,151 - INFO - [base] BEGIN (implicit)
2025-07-19 03:20:36,154 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:20:36,155 - INFO - [base] [generated in 0.00105s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:20:36,157 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:20:36,158 - INFO - [base] [cached since 0.00452s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:20:36,159 - INFO - [base] COMMIT
2025-07-19 03:20:37,375 - INFO - [dispatcher] Start polling
2025-07-19 03:20:37,632 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:20:39,956 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:20:39,957 - INFO - [base] BEGIN (implicit)
2025-07-19 03:20:39,962 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:20:39,963 - INFO - [base] [generated in 0.00077s] (7912699911,)
2025-07-19 03:20:39,965 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:20:39,966 - INFO - [base] [generated in 0.00072s] ('reddmon1761',)
2025-07-19 03:20:39,968 - INFO - [base] COMMIT
2025-07-19 03:20:41,064 - INFO - [dispatcher] Update id=433007656 is handled. Duration 1109 ms by bot id=7524145939
2025-07-19 03:20:46,853 - INFO - [dispatcher] Polling stopped
2025-07-19 03:20:46,853 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:20:46,854 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:20:47,041 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:20:50,892 - INFO - [base] select pg_catalog.version()
2025-07-19 03:20:50,892 - INFO - [base] [raw sql] ()
2025-07-19 03:20:50,894 - INFO - [base] select current_schema()
2025-07-19 03:20:50,894 - INFO - [base] [raw sql] ()
2025-07-19 03:20:50,895 - INFO - [base] show standard_conforming_strings
2025-07-19 03:20:50,896 - INFO - [base] [raw sql] ()
2025-07-19 03:20:50,896 - INFO - [base] BEGIN (implicit)
2025-07-19 03:20:50,900 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:20:50,901 - INFO - [base] [generated in 0.00140s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:20:50,904 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:20:50,904 - INFO - [base] [cached since 0.004336s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:20:50,905 - INFO - [base] COMMIT
2025-07-19 03:20:51,902 - INFO - [dispatcher] Start polling
2025-07-19 03:20:52,158 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:20:52,419 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:20:52,420 - INFO - [base] BEGIN (implicit)
2025-07-19 03:20:52,424 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:20:52,424 - INFO - [base] [generated in 0.00048s] (7912699911,)
2025-07-19 03:20:52,427 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:20:52,427 - INFO - [base] [generated in 0.00053s] ('reddmon1761',)
2025-07-19 03:20:52,430 - INFO - [base] COMMIT
2025-07-19 03:20:53,489 - INFO - [dispatcher] Update id=433007657 is handled. Duration 1063 ms by bot id=7524145939
2025-07-19 03:21:24,951 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:21:24,952 - INFO - [base] BEGIN (implicit)
2025-07-19 03:21:24,953 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:21:24,953 - INFO - [base] [cached since 32.53s ago] (7912699911,)
2025-07-19 03:21:24,954 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:21:24,955 - INFO - [base] [cached since 32.53s ago] ('reddmon1_835809',)
2025-07-19 03:21:24,955 - INFO - [base] COMMIT
2025-07-19 03:21:24,956 - ERROR - [handlers] Ошибка в обработчике /start с реферальным кодом: 'NoneType' object has no attribute 'username'
2025-07-19 03:21:25,227 - INFO - [dispatcher] Update id=433007658 is handled. Duration 266 ms by bot id=7524145939
2025-07-19 03:22:21,956 - INFO - [dispatcher] Polling stopped
2025-07-19 03:22:21,957 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:22:21,957 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:22:22,162 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:22:26,344 - INFO - [base] select pg_catalog.version()
2025-07-19 03:22:26,344 - INFO - [base] [raw sql] ()
2025-07-19 03:22:26,346 - INFO - [base] select current_schema()
2025-07-19 03:22:26,346 - INFO - [base] [raw sql] ()
2025-07-19 03:22:26,347 - INFO - [base] show standard_conforming_strings
2025-07-19 03:22:26,347 - INFO - [base] [raw sql] ()
2025-07-19 03:22:26,349 - INFO - [base] BEGIN (implicit)
2025-07-19 03:22:26,353 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:22:26,354 - INFO - [base] [generated in 0.00102s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:22:26,357 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:22:26,358 - INFO - [base] [cached since 0.005156s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:22:26,359 - INFO - [base] COMMIT
2025-07-19 03:22:27,505 - INFO - [dispatcher] Start polling
2025-07-19 03:22:27,766 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:22:31,132 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:22:31,133 - INFO - [base] BEGIN (implicit)
2025-07-19 03:22:31,138 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:22:31,139 - INFO - [base] [generated in 0.00089s] (7912699911,)
2025-07-19 03:22:31,142 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:22:31,143 - INFO - [base] [generated in 0.00080s] ('reddmon1_835809',)
2025-07-19 03:22:32,254 - INFO - [base] COMMIT
2025-07-19 03:22:32,256 - INFO - [dispatcher] Update id=433007659 is handled. Duration 1125 ms by bot id=7524145939
2025-07-19 03:22:39,792 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-19 03:22:39,792 - INFO - [base] BEGIN (implicit)
2025-07-19 03:22:39,793 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:22:39,794 - INFO - [base] [cached since 8.656s ago] (7912699911,)
2025-07-19 03:22:39,795 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-19 03:22:39,796 - INFO - [base] [cached since 8.654s ago] ('reddmon1761',)
2025-07-19 03:22:40,421 - INFO - [base] COMMIT
2025-07-19 03:22:40,422 - INFO - [dispatcher] Update id=433007660 is handled. Duration 625 ms by bot id=7524145939
2025-07-19 03:22:55,002 - INFO - [dispatcher] Polling stopped
2025-07-19 03:22:55,003 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-19 03:22:55,003 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 03:22:55,210 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:23:00,332 - INFO - [base] select pg_catalog.version()
2025-07-19 03:23:00,332 - INFO - [base] [raw sql] ()
2025-07-19 03:23:00,334 - INFO - [base] select current_schema()
2025-07-19 03:23:00,334 - INFO - [base] [raw sql] ()
2025-07-19 03:23:00,335 - INFO - [base] show standard_conforming_strings
2025-07-19 03:23:00,335 - INFO - [base] [raw sql] ()
2025-07-19 03:23:00,336 - INFO - [base] BEGIN (implicit)
2025-07-19 03:23:00,339 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:23:00,340 - INFO - [base] [generated in 0.00076s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:23:00,342 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-19 03:23:00,342 - INFO - [base] [cached since 0.003463s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-19 03:23:00,343 - INFO - [base] COMMIT
2025-07-19 03:23:01,483 - INFO - [dispatcher] Start polling
2025-07-19 03:23:01,740 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-19 03:23:01,999 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-19 03:23:02,000 - INFO - [base] BEGIN (implicit)
2025-07-19 03:23:02,006 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-19 03:23:02,007 - INFO - [base] [generated in 0.00112s] (1758719447,)
2025-07-19 03:23:02,010 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-19 03:23:02,010 - INFO - [base] [generated in 0.00066s] (6,)
2025-07-19 03:23:02,012 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-19 03:23:02,014 - INFO - [base] [generated in 0.00183s] (7,)
2025-07-19 03:23:02,016 - INFO - [base] COMMIT
2025-07-19 03:23:03,069 - INFO - [dispatcher] Update id=433007661 is handled. Duration 1062 ms by bot id=7524145939
2025-07-19 04:13:08,064 - ERROR - [dispatcher] Failed to fetch updates - TelegramRetryAfter: Telegram server says - Flood control exceeded on method 'GetUpdates'. Retry in 5 seconds.
Original description: Too Many Requests: retry after 5
(background on this error at: https://core.telegram.org/bots/faq#my-bot-is-hitting-limits-how-do-i-avoid-this)
2025-07-19 04:13:08,065 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-19 04:13:09,327 - ERROR - [dispatcher] Failed to fetch updates - TelegramRetryAfter: Telegram server says - Flood control exceeded on method 'GetUpdates'. Retry in 5 seconds.
Original description: Too Many Requests: retry after 5
(background on this error at: https://core.telegram.org/bots/faq#my-bot-is-hitting-limits-how-do-i-avoid-this)
2025-07-19 04:13:09,328 - WARNING - [dispatcher] Sleep for 1.395657 seconds and try again... (tryings = 1, bot id = 7524145939)
2025-07-19 04:13:12,860 - ERROR - [dispatcher] Failed to fetch updates - TelegramServerError: Telegram server says - Bad Gateway
2025-07-19 04:13:12,860 - WARNING - [dispatcher] Sleep for 1.683789 seconds and try again... (tryings = 2, bot id = 7524145939)
2025-07-19 04:13:15,581 - ERROR - [dispatcher] Failed to fetch updates - TelegramServerError: Telegram server says - Bad Gateway
2025-07-19 04:13:15,581 - WARNING - [dispatcher] Sleep for 2.096271 seconds and try again... (tryings = 3, bot id = 7524145939)
2025-07-19 04:13:38,290 - INFO - [dispatcher] Connection established (tryings = 4, bot id = 7524145939)
2025-07-21 15:53:08,471 - INFO - [base] select pg_catalog.version()
2025-07-21 15:53:08,471 - INFO - [base] [raw sql] ()
2025-07-21 15:53:08,473 - INFO - [base] select current_schema()
2025-07-21 15:53:08,473 - INFO - [base] [raw sql] ()
2025-07-21 15:53:08,474 - INFO - [base] show standard_conforming_strings
2025-07-21 15:53:08,474 - INFO - [base] [raw sql] ()
2025-07-21 15:53:08,475 - INFO - [base] BEGIN (implicit)
2025-07-21 15:53:08,478 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 15:53:08,478 - INFO - [base] [generated in 0.00063s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 15:53:08,481 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 15:53:08,482 - INFO - [base] [cached since 0.003861s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 15:53:08,483 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	total_bonus INTEGER GENERATED ALWAYS AS ((SELECT SUM(p.amount * 0.05) FROM purchases p JOIN users r ON p.user_id = r.id WHERE r.invited_by_id = users.id)) STORED, 
	paid_bonus INTEGER GENERATED ALWAYS AS ((SELECT SUM(p.amount * 0.05) FROM purchases p JOIN users r ON p.user_id = r.id WHERE r.invited_by_id = users.id AND p.bonus_paid = TRUE)) STORED, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-07-21 15:53:08,484 - INFO - [base] [no key 0.00124s] ()
2025-07-21 15:53:08,495 - INFO - [base] ROLLBACK
2025-07-21 17:01:33,336 - INFO - [base] select pg_catalog.version()
2025-07-21 17:01:33,337 - INFO - [base] [raw sql] ()
2025-07-21 17:01:33,338 - INFO - [base] select current_schema()
2025-07-21 17:01:33,338 - INFO - [base] [raw sql] ()
2025-07-21 17:01:33,339 - INFO - [base] show standard_conforming_strings
2025-07-21 17:01:33,339 - INFO - [base] [raw sql] ()
2025-07-21 17:01:33,340 - INFO - [base] BEGIN (implicit)
2025-07-21 17:01:33,343 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 17:01:33,343 - INFO - [base] [generated in 0.00066s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 17:01:33,346 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 17:01:33,346 - INFO - [base] [cached since 0.003363s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 17:01:33,347 - INFO - [base] COMMIT
2025-07-21 17:01:34,602 - INFO - [dispatcher] Start polling
2025-07-21 17:01:34,863 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-21 17:01:35,129 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-21 17:01:35,130 - INFO - [base] BEGIN (implicit)
2025-07-21 17:01:35,136 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:01:35,136 - INFO - [base] [generated in 0.00057s] (1758719447,)
2025-07-21 17:01:35,139 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 17:01:35,139 - INFO - [base] [generated in 0.00051s] (1758719447, 'reddmon1', 'reddmon1460', None, datetime.datetime(2025, 7, 21, 14, 1, 35, 139004))
2025-07-21 17:01:35,141 - INFO - [base] COMMIT
2025-07-21 17:01:36,246 - INFO - [dispatcher] Update id=433007662 is handled. Duration 1125 ms by bot id=7524145939
2025-07-21 17:01:36,704 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 1758719447
2025-07-21 17:01:36,705 - INFO - [base] BEGIN (implicit)
2025-07-21 17:01:36,706 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:01:36,706 - INFO - [base] [cached since 1.571s ago] (1758719447,)
2025-07-21 17:01:36,708 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 17:01:36,708 - INFO - [base] [generated in 0.00042s] ('reddmon1460',)
2025-07-21 17:01:37,017 - INFO - [base] COMMIT
2025-07-21 17:01:37,018 - INFO - [dispatcher] Update id=433007663 is handled. Duration 313 ms by bot id=7524145939
2025-07-21 17:05:18,304 - INFO - [handlers] Обработка /promo для пользователя 1758719447
2025-07-21 17:05:18,305 - INFO - [base] BEGIN (implicit)
2025-07-21 17:05:18,305 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:05:18,305 - INFO - [base] [cached since 223.2s ago] (1758719447,)
2025-07-21 17:05:18,306 - INFO - [base] COMMIT
2025-07-21 17:05:18,595 - INFO - [dispatcher] Update id=433007664 is handled. Duration 282 ms by bot id=7524145939
2025-07-21 17:05:23,488 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 17:05:23,489 - INFO - [base] BEGIN (implicit)
2025-07-21 17:05:23,489 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:05:23,490 - INFO - [base] [cached since 228.4s ago] (1758719447,)
2025-07-21 17:05:23,491 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 17:05:23,492 - INFO - [base] [generated in 0.00046s] (1,)
2025-07-21 17:05:23,493 - INFO - [base] COMMIT
2025-07-21 17:05:23,783 - INFO - [dispatcher] Update id=433007665 is handled. Duration 297 ms by bot id=7524145939
2025-07-21 17:16:19,649 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-21 17:16:19,650 - INFO - [base] BEGIN (implicit)
2025-07-21 17:16:19,651 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:16:19,651 - INFO - [base] [cached since 884.5s ago] (7912699911,)
2025-07-21 17:16:19,653 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 17:16:19,653 - INFO - [base] [cached since 884.5s ago] (7912699911, 'hreslxz', 'hreslxz493', None, datetime.datetime(2025, 7, 21, 14, 16, 19, 653660))
2025-07-21 17:16:19,654 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 17:16:19,654 - INFO - [base] [cached since 882.9s ago] ('reddmon1460',)
2025-07-21 17:16:19,996 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-21 17:16:19,996 - INFO - [base] [generated in 0.00053s] (1, 2)
2025-07-21 17:16:19,998 - INFO - [base] COMMIT
2025-07-21 17:16:19,999 - INFO - [dispatcher] Update id=433007666 is handled. Duration 344 ms by bot id=7524145939
2025-07-21 17:18:03,688 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 17:18:03,689 - INFO - [base] BEGIN (implicit)
2025-07-21 17:18:03,689 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:18:03,690 - INFO - [base] [cached since 988.6s ago] (1758719447,)
2025-07-21 17:18:03,691 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 17:18:03,691 - INFO - [base] [cached since 760.2s ago] (1,)
2025-07-21 17:18:03,693 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-21 17:18:03,693 - INFO - [base] [generated in 0.00047s] (2,)
2025-07-21 17:18:03,694 - INFO - [base] COMMIT
2025-07-21 17:18:03,982 - INFO - [dispatcher] Update id=433007667 is handled. Duration 297 ms by bot id=7524145939
2025-07-21 17:26:10,047 - INFO - [base] select pg_catalog.version()
2025-07-21 17:26:10,047 - INFO - [base] [raw sql] ()
2025-07-21 17:26:10,048 - INFO - [base] select current_schema()
2025-07-21 17:26:10,048 - INFO - [base] [raw sql] ()
2025-07-21 17:26:10,049 - INFO - [base] show standard_conforming_strings
2025-07-21 17:26:10,050 - INFO - [base] [raw sql] ()
2025-07-21 17:26:10,051 - INFO - [base] BEGIN (implicit)
2025-07-21 17:26:10,053 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 17:26:10,054 - INFO - [base] [generated in 0.00066s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 17:26:10,056 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 17:26:10,057 - INFO - [base] [cached since 0.003691s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 17:26:10,058 - INFO - [base] COMMIT
2025-07-21 17:26:11,278 - INFO - [dispatcher] Start polling
2025-07-21 17:26:11,537 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-21 17:26:22,063 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-21 17:26:22,064 - INFO - [base] BEGIN (implicit)
2025-07-21 17:26:22,069 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 17:26:22,070 - INFO - [base] [generated in 0.00057s] (1758719447,)
2025-07-21 17:26:22,073 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 17:26:22,073 - INFO - [base] [generated in 0.00044s] (1758719447, 'reddmon1', 'reddmon1555', None, datetime.datetime(2025, 7, 21, 14, 26, 22, 73554))
2025-07-21 17:26:22,074 - INFO - [base] COMMIT
2025-07-21 17:26:23,242 - INFO - [dispatcher] Update id=433007668 is handled. Duration 1188 ms by bot id=7524145939
2025-07-21 18:25:02,272 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-21 18:25:02,274 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:02,275 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:02,275 - INFO - [base] [cached since 3520s ago] (1758719447,)
2025-07-21 18:25:02,277 - INFO - [base] COMMIT
2025-07-21 18:25:03,112 - INFO - [dispatcher] Update id=433007669 is handled. Duration 843 ms by bot id=7524145939
2025-07-21 18:25:07,574 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:25:07,575 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:07,575 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:07,576 - INFO - [base] [cached since 3526s ago] (1758719447,)
2025-07-21 18:25:07,578 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 18:25:07,578 - INFO - [base] [generated in 0.00048s] (1,)
2025-07-21 18:25:07,579 - INFO - [base] COMMIT
2025-07-21 18:25:07,861 - INFO - [dispatcher] Update id=433007670 is handled. Duration 281 ms by bot id=7524145939
2025-07-21 18:25:25,591 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-21 18:25:25,591 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:25,592 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:25,592 - INFO - [base] [cached since 3544s ago] (7912699911,)
2025-07-21 18:25:25,594 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 18:25:25,594 - INFO - [base] [cached since 3544s ago] (7912699911, 'hreslxz', 'hreslxz389', None, datetime.datetime(2025, 7, 21, 15, 25, 25, 594435))
2025-07-21 18:25:25,596 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 18:25:25,596 - INFO - [base] [generated in 0.00042s] ('reddmon1460',)
2025-07-21 18:25:26,028 - INFO - [base] COMMIT
2025-07-21 18:25:26,029 - INFO - [dispatcher] Update id=433007671 is handled. Duration 436 ms by bot id=7524145939
2025-07-21 18:25:31,136 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:25:31,136 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:31,137 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:31,137 - INFO - [base] [cached since 3549s ago] (1758719447,)
2025-07-21 18:25:31,424 - INFO - [base] COMMIT
2025-07-21 18:25:31,425 - INFO - [dispatcher] Update id=433007672 is handled. Duration 281 ms by bot id=7524145939
2025-07-21 18:25:35,014 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-21 18:25:35,015 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:35,016 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:35,016 - INFO - [base] [cached since 3553s ago] (1758719447,)
2025-07-21 18:25:35,017 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 18:25:35,018 - INFO - [base] [cached since 3553s ago] (1758719447, 'reddmon1', 'reddmon1743', None, datetime.datetime(2025, 7, 21, 15, 25, 35, 17385))
2025-07-21 18:25:35,018 - INFO - [base] COMMIT
2025-07-21 18:25:35,330 - INFO - [dispatcher] Update id=433007673 is handled. Duration 311 ms by bot id=7524145939
2025-07-21 18:25:42,853 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:25:42,854 - INFO - [base] BEGIN (implicit)
2025-07-21 18:25:42,854 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:25:42,855 - INFO - [base] [cached since 3561s ago] (1758719447,)
2025-07-21 18:25:42,856 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 18:25:42,856 - INFO - [base] [cached since 35.28s ago] (3,)
2025-07-21 18:25:42,857 - INFO - [base] COMMIT
2025-07-21 18:25:43,245 - INFO - [dispatcher] Update id=433007674 is handled. Duration 390 ms by bot id=7524145939
2025-07-21 18:26:09,335 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7912699911
2025-07-21 18:26:09,336 - INFO - [base] BEGIN (implicit)
2025-07-21 18:26:09,336 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:26:09,337 - INFO - [base] [cached since 3587s ago] (7912699911,)
2025-07-21 18:26:09,338 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 18:26:09,338 - INFO - [base] [cached since 3587s ago] (7912699911, 'hreslxz', 'hreslxz996', None, datetime.datetime(2025, 7, 21, 15, 26, 9, 338860))
2025-07-21 18:26:09,339 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 18:26:09,340 - INFO - [base] [cached since 43.74s ago] ('reddmon1743',)
2025-07-21 18:26:09,645 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-21 18:26:09,646 - INFO - [base] [generated in 0.00051s] (3, 4)
2025-07-21 18:26:09,647 - INFO - [base] COMMIT
2025-07-21 18:26:09,648 - INFO - [dispatcher] Update id=433007675 is handled. Duration 311 ms by bot id=7524145939
2025-07-21 18:26:18,352 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:26:18,352 - INFO - [base] BEGIN (implicit)
2025-07-21 18:26:18,353 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:26:18,353 - INFO - [base] [cached since 3596s ago] (1758719447,)
2025-07-21 18:26:18,354 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 18:26:18,354 - INFO - [base] [cached since 70.78s ago] (3,)
2025-07-21 18:26:18,356 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-21 18:26:18,357 - INFO - [base] [generated in 0.00044s] (4,)
2025-07-21 18:26:18,358 - INFO - [base] COMMIT
2025-07-21 18:26:18,639 - INFO - [dispatcher] Update id=433007676 is handled. Duration 281 ms by bot id=7524145939
2025-07-21 18:27:03,788 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:27:03,789 - INFO - [base] BEGIN (implicit)
2025-07-21 18:27:03,789 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:27:03,790 - INFO - [base] [cached since 3642s ago] (1758719447,)
2025-07-21 18:27:03,790 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 18:27:03,791 - INFO - [base] [cached since 116.2s ago] (3,)
2025-07-21 18:27:03,792 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-21 18:27:03,792 - INFO - [base] [cached since 45.44s ago] (4,)
2025-07-21 18:27:03,793 - INFO - [base] COMMIT
2025-07-21 18:27:04,094 - INFO - [dispatcher] Update id=433007677 is handled. Duration 296 ms by bot id=7524145939
2025-07-21 18:29:54,421 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 18:29:54,422 - INFO - [base] BEGIN (implicit)
2025-07-21 18:29:54,422 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 18:29:54,423 - INFO - [base] [cached since 3812s ago] (1758719447,)
2025-07-21 18:29:54,424 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 18:29:54,424 - INFO - [base] [cached since 286.8s ago] (3,)
2025-07-21 18:29:54,425 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-21 18:29:54,425 - INFO - [base] [cached since 216.1s ago] (4,)
2025-07-21 18:29:54,426 - INFO - [base] COMMIT
2025-07-21 18:29:54,723 - INFO - [dispatcher] Update id=433007678 is handled. Duration 296 ms by bot id=7524145939
2025-07-21 21:39:19,633 - INFO - [base] select pg_catalog.version()
2025-07-21 21:39:19,634 - INFO - [base] [raw sql] ()
2025-07-21 21:39:19,635 - INFO - [base] select current_schema()
2025-07-21 21:39:19,635 - INFO - [base] [raw sql] ()
2025-07-21 21:39:19,636 - INFO - [base] show standard_conforming_strings
2025-07-21 21:39:19,636 - INFO - [base] [raw sql] ()
2025-07-21 21:39:19,637 - INFO - [base] BEGIN (implicit)
2025-07-21 21:39:19,640 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 21:39:19,641 - INFO - [base] [generated in 0.00071s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 21:39:19,643 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-21 21:39:19,644 - INFO - [base] [cached since 0.004404s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-21 21:39:19,645 - INFO - [base] COMMIT
2025-07-21 21:39:20,160 - INFO - [dispatcher] Start polling
2025-07-21 21:39:20,215 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-21 21:47:51,132 - INFO - [handlers] Обработка /start для пользователя 7936452658
2025-07-21 21:47:51,135 - INFO - [base] BEGIN (implicit)
2025-07-21 21:47:51,141 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:47:51,141 - INFO - [base] [generated in 0.00057s] (7936452658,)
2025-07-21 21:47:51,148 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 21:47:51,149 - INFO - [base] [generated in 0.00069s] (7936452658, 'BaliLove_Johny', 'BaliLove_Johny234', None, datetime.datetime(2025, 7, 21, 18, 47, 51, 148072))
2025-07-21 21:47:51,155 - INFO - [base] COMMIT
2025-07-21 21:47:51,381 - INFO - [dispatcher] Update id=433007679 is handled. Duration 250 ms by bot id=7524145939
2025-07-21 21:47:56,416 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7936452658
2025-07-21 21:47:56,417 - INFO - [base] BEGIN (implicit)
2025-07-21 21:47:56,417 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:47:56,418 - INFO - [base] [cached since 5.277s ago] (7936452658,)
2025-07-21 21:47:56,419 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 21:47:56,420 - INFO - [base] [generated in 0.00045s] ('BaliLove_Johny234',)
2025-07-21 21:47:56,500 - INFO - [base] COMMIT
2025-07-21 21:47:56,500 - INFO - [dispatcher] Update id=433007680 is handled. Duration 78 ms by bot id=7524145939
2025-07-21 21:47:59,368 - INFO - [handlers] Обработка /help для пользователя 1758719447
2025-07-21 21:47:59,446 - INFO - [dispatcher] Update id=433007681 is handled. Duration 78 ms by bot id=7524145939
2025-07-21 21:48:02,127 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-21 21:48:02,128 - INFO - [base] BEGIN (implicit)
2025-07-21 21:48:02,129 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:48:02,129 - INFO - [base] [cached since 10.99s ago] (1758719447,)
2025-07-21 21:48:02,130 - INFO - [base] COMMIT
2025-07-21 21:48:02,220 - INFO - [dispatcher] Update id=433007682 is handled. Duration 94 ms by bot id=7524145939
2025-07-21 21:48:41,503 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7936452658
2025-07-21 21:48:41,504 - INFO - [base] BEGIN (implicit)
2025-07-21 21:48:41,504 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:48:41,505 - INFO - [base] [cached since 50.36s ago] (7936452658,)
2025-07-21 21:48:41,506 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 21:48:41,506 - INFO - [base] [cached since 45.09s ago] ('BaliLove_Johny234',)
2025-07-21 21:48:41,618 - INFO - [base] COMMIT
2025-07-21 21:48:41,619 - INFO - [dispatcher] Update id=433007683 is handled. Duration 125 ms by bot id=7524145939
2025-07-21 21:48:51,816 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7805579408
2025-07-21 21:48:51,816 - INFO - [base] BEGIN (implicit)
2025-07-21 21:48:51,817 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:48:51,817 - INFO - [base] [cached since 60.68s ago] (7805579408,)
2025-07-21 21:48:51,819 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 21:48:51,819 - INFO - [base] [cached since 60.67s ago] (7805579408, 'lonelysinner13', 'lonelysinner13247', None, datetime.datetime(2025, 7, 21, 18, 48, 51, 819613))
2025-07-21 21:48:51,820 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 21:48:51,820 - INFO - [base] [cached since 55.4s ago] ('BaliLove_Johny234',)
2025-07-21 21:48:51,911 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-21 21:48:51,911 - INFO - [base] [generated in 0.00044s] (5, 6)
2025-07-21 21:48:51,918 - INFO - [base] COMMIT
2025-07-21 21:48:51,919 - INFO - [dispatcher] Update id=433007684 is handled. Duration 110 ms by bot id=7524145939
2025-07-21 21:49:23,804 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-07-21 21:49:23,805 - INFO - [base] BEGIN (implicit)
2025-07-21 21:49:23,805 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 21:49:23,806 - INFO - [base] [cached since 92.67s ago] (7731533840,)
2025-07-21 21:49:23,808 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-21 21:49:23,809 - INFO - [base] [cached since 92.66s ago] (7731533840, 'Неизвестный', '988', None, datetime.datetime(2025, 7, 21, 18, 49, 23, 808710))
2025-07-21 21:49:23,810 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-21 21:49:23,810 - INFO - [base] [cached since 87.39s ago] ('BaliLove_Johny234',)
2025-07-21 21:49:23,900 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-21 21:49:23,901 - INFO - [base] [cached since 31.99s ago] (5, 7)
2025-07-21 21:49:23,902 - INFO - [base] COMMIT
2025-07-21 21:49:23,902 - INFO - [dispatcher] Update id=433007685 is handled. Duration 94 ms by bot id=7524145939
2025-07-21 22:01:14,299 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-21 22:01:14,299 - INFO - [base] BEGIN (implicit)
2025-07-21 22:01:14,300 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-21 22:01:14,300 - INFO - [base] [cached since 803.2s ago] (1758719447,)
2025-07-21 22:01:14,301 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-21 22:01:14,302 - INFO - [base] [generated in 0.00043s] (3,)
2025-07-21 22:01:14,304 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-21 22:01:14,304 - INFO - [base] [generated in 0.00046s] (4,)
2025-07-21 22:01:14,305 - INFO - [base] COMMIT
2025-07-21 22:01:14,517 - INFO - [dispatcher] Update id=433007686 is handled. Duration 219 ms by bot id=7524145939
2025-07-22 12:47:13,809 - INFO - [base] select pg_catalog.version()
2025-07-22 12:47:13,809 - INFO - [base] [raw sql] ()
2025-07-22 12:47:13,811 - INFO - [base] select current_schema()
2025-07-22 12:47:13,811 - INFO - [base] [raw sql] ()
2025-07-22 12:47:13,812 - INFO - [base] show standard_conforming_strings
2025-07-22 12:47:13,812 - INFO - [base] [raw sql] ()
2025-07-22 12:47:13,813 - INFO - [base] BEGIN (implicit)
2025-07-22 12:47:13,815 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 12:47:13,816 - INFO - [base] [generated in 0.00069s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 12:47:13,818 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 12:47:13,819 - INFO - [base] [cached since 0.003535s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 12:47:13,820 - INFO - [base] COMMIT
2025-07-22 12:47:15,084 - INFO - [dispatcher] Start polling
2025-07-22 12:47:15,361 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 12:47:15,639 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-22 12:47:15,640 - INFO - [base] BEGIN (implicit)
2025-07-22 12:47:15,645 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 12:47:15,645 - INFO - [base] [generated in 0.00047s] (1758719447,)
2025-07-22 12:47:15,648 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-22 12:47:15,648 - INFO - [base] [generated in 0.00052s] (3,)
2025-07-22 12:47:15,650 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-22 12:47:15,651 - INFO - [base] [generated in 0.00055s] (4,)
2025-07-22 12:47:15,652 - INFO - [base] COMMIT
2025-07-22 12:47:16,922 - INFO - [dispatcher] Update id=433007687 is handled. Duration 1281 ms by bot id=7524145939
2025-07-22 12:47:32,919 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-22 12:47:32,920 - INFO - [base] BEGIN (implicit)
2025-07-22 12:47:32,920 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 12:47:32,921 - INFO - [base] [cached since 17.28s ago] (1758719447,)
2025-07-22 12:47:32,922 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-22 12:47:32,922 - INFO - [base] [cached since 17.27s ago] (3,)
2025-07-22 12:47:32,923 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-22 12:47:32,923 - INFO - [base] [cached since 17.27s ago] (4,)
2025-07-22 12:47:32,924 - INFO - [base] COMMIT
2025-07-22 12:47:33,319 - INFO - [dispatcher] Update id=433007688 is handled. Duration 406 ms by bot id=7524145939
2025-07-22 13:06:05,246 - INFO - [dispatcher] Polling stopped
2025-07-22 13:06:05,247 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-22 13:06:05,247 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-22 13:06:05,434 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 13:06:09,407 - INFO - [base] select pg_catalog.version()
2025-07-22 13:06:09,407 - INFO - [base] [raw sql] ()
2025-07-22 13:06:09,409 - INFO - [base] select current_schema()
2025-07-22 13:06:09,409 - INFO - [base] [raw sql] ()
2025-07-22 13:06:09,410 - INFO - [base] show standard_conforming_strings
2025-07-22 13:06:09,410 - INFO - [base] [raw sql] ()
2025-07-22 13:06:09,411 - INFO - [base] BEGIN (implicit)
2025-07-22 13:06:09,414 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:06:09,414 - INFO - [base] [generated in 0.00067s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:06:09,417 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:06:09,417 - INFO - [base] [cached since 0.003402s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:06:09,418 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-07-22 13:06:09,419 - INFO - [base] [no key 0.00094s] ()
2025-07-22 13:06:09,428 - INFO - [base] 
CREATE TABLE purchases (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	name VARCHAR, 
	amount BIGINT, 
	discount_applied INTEGER, 
	bonus_amount BIGINT NOT NULL, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	bonus_paid BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-22 13:06:09,429 - INFO - [base] [no key 0.00101s] ()
2025-07-22 13:06:09,433 - INFO - [base] COMMIT
2025-07-22 13:06:10,707 - INFO - [dispatcher] Start polling
2025-07-22 13:06:10,973 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 13:06:56,698 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-07-22 13:06:56,702 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-22 13:07:08,101 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-07-22 13:08:16,549 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-22 13:08:16,550 - INFO - [base] BEGIN (implicit)
2025-07-22 13:08:16,555 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 13:08:16,555 - INFO - [base] [generated in 0.00053s] (1758719447,)
2025-07-22 13:08:16,559 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 13:08:16,560 - INFO - [base] [generated in 0.00083s] (1758719447, 'reddmon1', 'reddmon1863', None, datetime.datetime(2025, 7, 22, 10, 8, 16, 559651))
2025-07-22 13:08:16,563 - INFO - [base] COMMIT
2025-07-22 13:08:16,763 - INFO - [dispatcher] Update id=433007689 is handled. Duration 218 ms by bot id=7524145939
2025-07-22 13:34:09,532 - INFO - [base] select pg_catalog.version()
2025-07-22 13:34:09,532 - INFO - [base] [raw sql] ()
2025-07-22 13:34:09,533 - INFO - [base] select current_schema()
2025-07-22 13:34:09,533 - INFO - [base] [raw sql] ()
2025-07-22 13:34:09,534 - INFO - [base] show standard_conforming_strings
2025-07-22 13:34:09,534 - INFO - [base] [raw sql] ()
2025-07-22 13:34:09,535 - INFO - [base] BEGIN (implicit)
2025-07-22 13:34:09,538 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:34:09,539 - INFO - [base] [generated in 0.00072s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:34:09,541 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:34:09,542 - INFO - [base] [cached since 0.003659s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:34:09,542 - INFO - [base] COMMIT
2025-07-22 13:34:10,035 - INFO - [dispatcher] Start polling
2025-07-22 13:34:10,095 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 13:34:10,157 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-22 13:34:10,158 - INFO - [base] BEGIN (implicit)
2025-07-22 13:34:10,162 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 13:34:10,163 - INFO - [base] [generated in 0.00064s] (1758719447,)
2025-07-22 13:34:10,166 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 13:34:10,166 - INFO - [base] [generated in 0.00045s] (1758719447, 'reddmon1', 'reddmon1112', None, datetime.datetime(2025, 7, 22, 10, 34, 10, 166281))
2025-07-22 13:34:10,168 - INFO - [base] COMMIT
2025-07-22 13:34:10,440 - INFO - [dispatcher] Update id=433007690 is handled. Duration 281 ms by bot id=7524145939
2025-07-22 13:35:10,335 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-07-22 13:35:10,336 - INFO - [base] BEGIN (implicit)
2025-07-22 13:35:10,337 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 13:35:10,337 - INFO - [base] [cached since 60.17s ago] (7731533840,)
2025-07-22 13:35:10,338 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 13:35:10,338 - INFO - [base] [cached since 60.17s ago] (7731533840, 'Неизвестный', '531', None, datetime.datetime(2025, 7, 22, 10, 35, 10, 338485))
2025-07-22 13:35:10,340 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-22 13:35:10,340 - INFO - [base] [generated in 0.00041s] ('reddmon1112',)
2025-07-22 13:35:10,629 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-22 13:35:10,630 - INFO - [base] [generated in 0.00047s] (1, 2)
2025-07-22 13:35:10,632 - INFO - [base] COMMIT
2025-07-22 13:35:10,633 - INFO - [dispatcher] Update id=433007691 is handled. Duration 297 ms by bot id=7524145939
2025-07-22 13:37:14,936 - INFO - [dispatcher] Polling stopped
2025-07-22 13:37:14,937 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-07-22 13:37:14,937 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-07-22 13:37:15,124 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 13:37:18,914 - INFO - [base] select pg_catalog.version()
2025-07-22 13:37:18,915 - INFO - [base] [raw sql] ()
2025-07-22 13:37:18,916 - INFO - [base] select current_schema()
2025-07-22 13:37:18,916 - INFO - [base] [raw sql] ()
2025-07-22 13:37:18,917 - INFO - [base] show standard_conforming_strings
2025-07-22 13:37:18,918 - INFO - [base] [raw sql] ()
2025-07-22 13:37:18,918 - INFO - [base] BEGIN (implicit)
2025-07-22 13:37:18,921 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:37:18,922 - INFO - [base] [generated in 0.00063s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:37:18,925 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-22 13:37:18,925 - INFO - [base] [cached since 0.003947s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-22 13:37:18,927 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-07-22 13:37:18,928 - INFO - [base] [no key 0.00146s] ()
2025-07-22 13:37:18,934 - INFO - [base] 
CREATE TABLE purchases (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	name VARCHAR, 
	amount BIGINT, 
	discount_applied INTEGER, 
	bonus_amount BIGINT NOT NULL, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	bonus_paid BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-22 13:37:18,935 - INFO - [base] [no key 0.00101s] ()
2025-07-22 13:37:18,938 - INFO - [base] COMMIT
2025-07-22 13:37:19,287 - INFO - [dispatcher] Start polling
2025-07-22 13:37:19,341 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-22 13:38:11,901 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-22 13:38:11,902 - INFO - [base] BEGIN (implicit)
2025-07-22 13:38:11,908 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 13:38:11,908 - INFO - [base] [generated in 0.00060s] (1758719447,)
2025-07-22 13:38:11,911 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 13:38:11,912 - INFO - [base] [generated in 0.00054s] (1758719447, 'reddmon1', 'reddmon1295', None, datetime.datetime(2025, 7, 22, 10, 38, 11, 911043))
2025-07-22 13:38:11,913 - INFO - [base] COMMIT
2025-07-22 13:38:12,282 - INFO - [dispatcher] Update id=433007692 is handled. Duration 375 ms by bot id=7524145939
2025-07-22 13:38:27,755 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-07-22 13:38:27,756 - INFO - [base] BEGIN (implicit)
2025-07-22 13:38:27,756 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 13:38:27,757 - INFO - [base] [cached since 15.85s ago] (7731533840,)
2025-07-22 13:38:27,758 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 13:38:27,758 - INFO - [base] [cached since 15.85s ago] (7731533840, 'Неизвестный', '469', None, datetime.datetime(2025, 7, 22, 10, 38, 27, 758810))
2025-07-22 13:38:27,759 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-22 13:38:27,760 - INFO - [base] [generated in 0.00045s] ('reddmon1295',)
2025-07-22 13:38:27,908 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-22 13:38:27,908 - INFO - [base] [generated in 0.00041s] (1, 2)
2025-07-22 13:38:27,909 - INFO - [base] COMMIT
2025-07-22 13:38:27,910 - INFO - [dispatcher] Update id=433007693 is handled. Duration 139 ms by bot id=7524145939
2025-07-22 14:02:34,205 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-22 14:02:34,206 - INFO - [base] BEGIN (implicit)
2025-07-22 14:02:34,206 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:02:34,207 - INFO - [base] [cached since 1462s ago] (1758719447,)
2025-07-22 14:02:34,208 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 14:02:34,209 - INFO - [base] [cached since 1462s ago] (1758719447, 'reddmon1', 'reddmon1500', None, datetime.datetime(2025, 7, 22, 11, 2, 34, 208481))
2025-07-22 14:02:34,210 - INFO - [base] COMMIT
2025-07-22 14:02:34,341 - INFO - [dispatcher] Update id=433007694 is handled. Duration 140 ms by bot id=7524145939
2025-07-22 14:04:36,109 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-22 14:04:36,110 - INFO - [base] BEGIN (implicit)
2025-07-22 14:04:36,110 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:04:36,111 - INFO - [base] [cached since 1584s ago] (1758719447,)
2025-07-22 14:04:36,112 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 14:04:36,113 - INFO - [base] [cached since 1584s ago] (1758719447, 'reddmon1', 'reddmon1759', None, datetime.datetime(2025, 7, 22, 11, 4, 36, 112237))
2025-07-22 14:04:36,114 - INFO - [base] COMMIT
2025-07-22 14:04:36,205 - INFO - [dispatcher] Update id=433007695 is handled. Duration 94 ms by bot id=7524145939
2025-07-22 14:06:06,300 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-07-22 14:06:06,301 - INFO - [base] BEGIN (implicit)
2025-07-22 14:06:06,301 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:06:06,301 - INFO - [base] [cached since 1674s ago] (7731533840,)
2025-07-22 14:06:06,302 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-22 14:06:06,303 - INFO - [base] [cached since 1674s ago] (7731533840, 'Неизвестный', '582', None, datetime.datetime(2025, 7, 22, 11, 6, 6, 302194))
2025-07-22 14:06:06,304 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-22 14:06:06,304 - INFO - [base] [cached since 1659s ago] ('reddmon1759',)
2025-07-22 14:06:06,402 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-22 14:06:06,403 - INFO - [base] [cached since 1658s ago] (1, 2)
2025-07-22 14:06:06,404 - INFO - [base] COMMIT
2025-07-22 14:06:06,405 - INFO - [dispatcher] Update id=433007696 is handled. Duration 108 ms by bot id=7524145939
2025-07-22 14:48:36,530 - INFO - [handlers] Обработка /promo для пользователя 1758719447
2025-07-22 14:48:36,531 - INFO - [base] BEGIN (implicit)
2025-07-22 14:48:36,532 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:48:36,532 - INFO - [base] [cached since 4225s ago] (1758719447,)
2025-07-22 14:48:36,533 - INFO - [base] COMMIT
2025-07-22 14:48:37,658 - INFO - [dispatcher] Update id=433007697 is handled. Duration 1125 ms by bot id=7524145939
2025-07-22 14:48:39,231 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-22 14:48:39,232 - INFO - [base] BEGIN (implicit)
2025-07-22 14:48:39,233 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:48:39,233 - INFO - [base] [cached since 4227s ago] (1758719447,)
2025-07-22 14:48:39,235 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-22 14:48:39,235 - INFO - [base] [generated in 0.00043s] (1,)
2025-07-22 14:48:39,237 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-22 14:48:39,237 - INFO - [base] [generated in 0.00048s] (2,)
2025-07-22 14:48:39,239 - INFO - [base] COMMIT
2025-07-22 14:48:39,609 - INFO - [dispatcher] Update id=433007698 is handled. Duration 375 ms by bot id=7524145939
2025-07-22 14:48:47,443 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-07-22 14:48:47,443 - INFO - [base] BEGIN (implicit)
2025-07-22 14:48:47,444 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-22 14:48:47,444 - INFO - [base] [cached since 4236s ago] (1758719447,)
2025-07-22 14:48:47,445 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-22 14:48:47,446 - INFO - [base] [cached since 8.211s ago] (1,)
2025-07-22 14:48:47,446 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-22 14:48:47,447 - INFO - [base] [cached since 8.21s ago] (2,)
2025-07-22 14:48:47,447 - INFO - [base] COMMIT
2025-07-22 14:48:47,734 - INFO - [dispatcher] Update id=433007699 is handled. Duration 280 ms by bot id=7524145939
2025-07-23 11:57:41,213 - INFO - [base] select pg_catalog.version()
2025-07-23 11:57:41,214 - INFO - [base] [raw sql] ()
2025-07-23 11:57:41,215 - INFO - [base] select current_schema()
2025-07-23 11:57:41,215 - INFO - [base] [raw sql] ()
2025-07-23 11:57:41,216 - INFO - [base] show standard_conforming_strings
2025-07-23 11:57:41,216 - INFO - [base] [raw sql] ()
2025-07-23 11:57:41,217 - INFO - [base] BEGIN (implicit)
2025-07-23 11:57:41,220 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-23 11:57:41,221 - INFO - [base] [generated in 0.00067s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-23 11:57:41,223 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-07-23 11:57:41,224 - INFO - [base] [cached since 0.00395s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-07-23 11:57:41,225 - INFO - [base] COMMIT
2025-07-23 11:57:41,555 - INFO - [dispatcher] Start polling
2025-07-23 11:57:41,597 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-07-23 11:57:41,642 - INFO - [handlers] Обработка /start для пользователя 7936452658
2025-07-23 11:57:41,643 - INFO - [base] BEGIN (implicit)
2025-07-23 11:57:41,648 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 11:57:41,648 - INFO - [base] [generated in 0.00048s] (7936452658,)
2025-07-23 11:57:41,656 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-23 11:57:41,657 - INFO - [base] [generated in 0.00066s] (7936452658, 'BaliLove_Johny', 'BaliLove_Johny269', None, datetime.datetime(2025, 7, 23, 8, 57, 41, 656825))
2025-07-23 11:57:41,665 - INFO - [base] COMMIT
2025-07-23 11:57:41,858 - INFO - [dispatcher] Update id=433007700 is handled. Duration 218 ms by bot id=7524145939
2025-07-23 11:58:58,342 - INFO - [handlers] Обработка /start для пользователя 239430681
2025-07-23 11:58:58,343 - INFO - [base] BEGIN (implicit)
2025-07-23 11:58:58,343 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 11:58:58,344 - INFO - [base] [cached since 76.7s ago] (239430681,)
2025-07-23 11:58:58,345 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-23 11:58:58,345 - INFO - [base] [cached since 76.69s ago] (239430681, 'Dent1st', 'Dent1st660', None, datetime.datetime(2025, 7, 23, 8, 58, 58, 345988))
2025-07-23 11:58:58,346 - INFO - [base] COMMIT
2025-07-23 11:58:58,452 - INFO - [dispatcher] Update id=433007701 is handled. Duration 108 ms by bot id=7524145939
2025-07-23 11:59:10,432 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 239430681
2025-07-23 11:59:10,432 - INFO - [base] BEGIN (implicit)
2025-07-23 11:59:10,433 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 11:59:10,433 - INFO - [base] [cached since 88.78s ago] (239430681,)
2025-07-23 11:59:10,435 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-23 11:59:10,435 - INFO - [base] [generated in 0.00052s] ('Dent1st660',)
2025-07-23 11:59:10,551 - INFO - [base] COMMIT
2025-07-23 11:59:10,552 - INFO - [dispatcher] Update id=433007702 is handled. Duration 110 ms by bot id=7524145939
2025-07-23 12:00:05,114 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 6559386093
2025-07-23 12:00:05,115 - INFO - [base] BEGIN (implicit)
2025-07-23 12:00:05,115 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 12:00:05,116 - INFO - [base] [cached since 143.5s ago] (6559386093,)
2025-07-23 12:00:05,117 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-23 12:00:05,117 - INFO - [base] [cached since 143.5s ago] (6559386093, 'Visa4bali', 'Visa4bali880', None, datetime.datetime(2025, 7, 23, 9, 0, 5, 117888))
2025-07-23 12:00:05,118 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-23 12:00:05,119 - INFO - [base] [cached since 54.68s ago] ('Dent1st660',)
2025-07-23 12:00:05,313 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-23 12:00:05,313 - INFO - [base] [generated in 0.00049s] (4, 5)
2025-07-23 12:00:05,331 - INFO - [base] COMMIT
2025-07-23 12:00:05,331 - INFO - [dispatcher] Update id=433007703 is handled. Duration 218 ms by bot id=7524145939
2025-07-23 12:05:53,412 - INFO - [handlers] Обработка /bonuses для пользователя 239430681
2025-07-23 12:05:53,413 - INFO - [base] BEGIN (implicit)
2025-07-23 12:05:53,413 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 12:05:53,413 - INFO - [base] [cached since 491.8s ago] (239430681,)
2025-07-23 12:05:53,415 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-07-23 12:05:53,415 - INFO - [base] [generated in 0.00044s] (4,)
2025-07-23 12:05:53,417 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-07-23 12:05:53,417 - INFO - [base] [generated in 0.00046s] (5,)
2025-07-23 12:05:53,419 - INFO - [base] COMMIT
2025-07-23 12:05:53,658 - INFO - [dispatcher] Update id=433007704 is handled. Duration 250 ms by bot id=7524145939
2025-07-23 14:39:54,739 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-07-23 14:39:54,740 - INFO - [base] BEGIN (implicit)
2025-07-23 14:39:54,740 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 14:39:54,741 - INFO - [base] [cached since 9733s ago] (1758719447,)
2025-07-23 14:39:54,743 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-23 14:39:54,743 - INFO - [base] [cached since 9733s ago] (1758719447, 'reddmon1', 'reddmon1505', None, datetime.datetime(2025, 7, 23, 11, 39, 54, 743885))
2025-07-23 14:39:54,744 - INFO - [base] COMMIT
2025-07-23 14:39:54,996 - INFO - [dispatcher] Update id=433007705 is handled. Duration 265 ms by bot id=7524145939
2025-07-23 14:41:47,484 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-07-23 14:41:47,485 - INFO - [base] BEGIN (implicit)
2025-07-23 14:41:47,485 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-07-23 14:41:47,486 - INFO - [base] [cached since 9846s ago] (7731533840,)
2025-07-23 14:41:47,487 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-07-23 14:41:47,487 - INFO - [base] [cached since 9846s ago] (7731533840, 'Неизвестный', '410', None, datetime.datetime(2025, 7, 23, 11, 41, 47, 487217))
2025-07-23 14:41:47,488 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-07-23 14:41:47,488 - INFO - [base] [cached since 9757s ago] ('reddmon1505',)
2025-07-23 14:41:47,557 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-07-23 14:41:47,558 - INFO - [base] [cached since 9702s ago] (1, 2)
2025-07-23 14:41:47,559 - INFO - [base] COMMIT
2025-07-23 14:41:47,559 - INFO - [dispatcher] Update id=433007706 is handled. Duration 78 ms by bot id=7524145939
2025-08-04 03:18:38,521 - INFO - [base] select pg_catalog.version()
2025-08-04 03:18:38,522 - INFO - [base] [raw sql] ()
2025-08-04 03:18:38,526 - INFO - [base] select current_schema()
2025-08-04 03:18:38,526 - INFO - [base] [raw sql] ()
2025-08-04 03:18:38,528 - INFO - [base] show standard_conforming_strings
2025-08-04 03:18:38,528 - INFO - [base] [raw sql] ()
2025-08-04 03:18:38,529 - INFO - [base] BEGIN (implicit)
2025-08-04 03:18:38,533 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:18:38,534 - INFO - [base] [generated in 0.00087s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:18:38,543 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:18:38,543 - INFO - [base] [cached since 0.01018s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:18:38,544 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:18:38,544 - INFO - [base] [cached since 0.01137s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:18:38,545 - INFO - [base] 
CREATE TABLE bonus_history (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	amount BIGINT, 
	operation VARCHAR, 
	description VARCHAR, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-04 03:18:38,546 - INFO - [base] [no key 0.00081s] ()
2025-08-04 03:18:38,567 - INFO - [base] COMMIT
2025-08-04 03:18:38,883 - INFO - [dispatcher] Start polling
2025-08-04 03:18:38,928 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 03:18:54,483 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 03:18:54,484 - INFO - [base] BEGIN (implicit)
2025-08-04 03:18:54,491 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:18:54,491 - INFO - [base] [generated in 0.00053s] (1758719447,)
2025-08-04 03:18:54,494 - INFO - [base] COMMIT
2025-08-04 03:18:54,676 - INFO - [dispatcher] Update id=433007707 is handled. Duration 188 ms by bot id=7524145939
2025-08-04 03:18:59,355 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 03:18:59,356 - INFO - [base] BEGIN (implicit)
2025-08-04 03:18:59,356 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:18:59,357 - INFO - [base] [cached since 4.867s ago] (1758719447,)
2025-08-04 03:18:59,358 - INFO - [base] COMMIT
2025-08-04 03:18:59,421 - INFO - [dispatcher] Update id=433007708 is handled. Duration 63 ms by bot id=7524145939
2025-08-04 03:19:01,586 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 03:19:01,586 - INFO - [base] BEGIN (implicit)
2025-08-04 03:19:01,587 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:19:01,587 - INFO - [base] [cached since 7.097s ago] (1758719447,)
2025-08-04 03:19:01,589 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 03:19:01,589 - INFO - [base] [generated in 0.00042s] (1,)
2025-08-04 03:19:01,591 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-08-04 03:19:01,592 - INFO - [base] [generated in 0.00045s] (2,)
2025-08-04 03:19:01,665 - INFO - [base] COMMIT
2025-08-04 03:19:01,666 - INFO - [dispatcher] Update id=433007709 is handled. Duration 77 ms by bot id=7524145939
2025-08-04 03:19:03,277 - INFO - [dispatcher] Update id=433007710 is not handled. Duration 0 ms by bot id=7524145939
2025-08-04 03:19:03,277 - ERROR - [dispatcher] Cause exception while process update id=433007710 by bot id=7524145939
TypeError: bonus_received() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: bonus_received() missing 1 required positional argument: 'session'
2025-08-04 03:19:33,523 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 03:19:33,523 - INFO - [base] BEGIN (implicit)
2025-08-04 03:19:33,524 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:19:33,524 - INFO - [base] [cached since 39.03s ago] (1758719447,)
2025-08-04 03:19:33,526 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 03:19:33,527 - INFO - [base] [generated in 0.00065s] (1, 10)
2025-08-04 03:19:33,590 - INFO - [base] COMMIT
2025-08-04 03:19:33,590 - INFO - [dispatcher] Update id=433007711 is handled. Duration 78 ms by bot id=7524145939
2025-08-04 03:20:06,985 - INFO - [dispatcher] Polling stopped
2025-08-04 03:20:06,986 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 03:20:06,986 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 03:20:07,171 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 03:20:11,557 - INFO - [base] select pg_catalog.version()
2025-08-04 03:20:11,557 - INFO - [base] [raw sql] ()
2025-08-04 03:20:11,558 - INFO - [base] select current_schema()
2025-08-04 03:20:11,559 - INFO - [base] [raw sql] ()
2025-08-04 03:20:11,559 - INFO - [base] show standard_conforming_strings
2025-08-04 03:20:11,560 - INFO - [base] [raw sql] ()
2025-08-04 03:20:11,561 - INFO - [base] BEGIN (implicit)
2025-08-04 03:20:11,564 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:20:11,565 - INFO - [base] [generated in 0.00067s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:20:11,567 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:20:11,568 - INFO - [base] [cached since 0.003774s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:20:11,569 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 03:20:11,569 - INFO - [base] [cached since 0.005105s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 03:20:11,570 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-08-04 03:20:11,572 - INFO - [base] [no key 0.00146s] ()
2025-08-04 03:20:11,578 - INFO - [base] 
CREATE TABLE purchases (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	name VARCHAR, 
	amount BIGINT, 
	discount_applied INTEGER, 
	bonus_amount BIGINT NOT NULL, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	bonus_paid BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-04 03:20:11,579 - INFO - [base] [no key 0.00097s] ()
2025-08-04 03:20:11,582 - INFO - [base] 
CREATE TABLE bonus_history (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	amount BIGINT, 
	operation VARCHAR, 
	description VARCHAR, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-04 03:20:11,583 - INFO - [base] [no key 0.00081s] ()
2025-08-04 03:20:11,587 - INFO - [base] COMMIT
2025-08-04 03:20:11,901 - INFO - [dispatcher] Start polling
2025-08-04 03:20:11,949 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 03:20:14,291 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 03:20:14,292 - INFO - [base] BEGIN (implicit)
2025-08-04 03:20:14,298 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:20:14,299 - INFO - [base] [generated in 0.00062s] (1758719447,)
2025-08-04 03:20:14,302 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 03:20:14,302 - INFO - [base] [generated in 0.00054s] (1758719447, 'reddmon1', 'reddmon1', None, datetime.datetime(2025, 8, 4, 0, 20, 14, 302123))
2025-08-04 03:20:14,304 - INFO - [base] COMMIT
2025-08-04 03:20:14,483 - INFO - [dispatcher] Update id=433007712 is handled. Duration 186 ms by bot id=7524145939
2025-08-04 03:20:30,871 - INFO - [handlers] Обработка /help для пользователя 1758719447
2025-08-04 03:20:30,947 - INFO - [dispatcher] Update id=433007713 is handled. Duration 77 ms by bot id=7524145939
2025-08-04 03:20:33,943 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 03:20:33,943 - INFO - [base] BEGIN (implicit)
2025-08-04 03:20:33,944 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:20:33,944 - INFO - [base] [cached since 19.65s ago] (1758719447,)
2025-08-04 03:20:33,946 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 03:20:33,947 - INFO - [base] [generated in 0.00061s] (1, 10)
2025-08-04 03:20:34,012 - INFO - [base] COMMIT
2025-08-04 03:20:34,013 - INFO - [dispatcher] Update id=433007714 is handled. Duration 78 ms by bot id=7524145939
2025-08-04 03:20:39,861 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 03:20:39,862 - INFO - [base] BEGIN (implicit)
2025-08-04 03:20:39,862 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 03:20:39,863 - INFO - [base] [cached since 25.57s ago] (1758719447,)
2025-08-04 03:20:39,864 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 03:20:39,864 - INFO - [base] [generated in 0.00046s] (1,)
2025-08-04 03:20:39,932 - INFO - [base] COMMIT
2025-08-04 03:20:39,933 - INFO - [dispatcher] Update id=433007715 is handled. Duration 78 ms by bot id=7524145939
2025-08-04 13:24:50,723 - INFO - [base] select pg_catalog.version()
2025-08-04 13:24:50,724 - INFO - [base] [raw sql] ()
2025-08-04 13:24:50,725 - INFO - [base] select current_schema()
2025-08-04 13:24:50,725 - INFO - [base] [raw sql] ()
2025-08-04 13:24:50,726 - INFO - [base] show standard_conforming_strings
2025-08-04 13:24:50,727 - INFO - [base] [raw sql] ()
2025-08-04 13:24:50,728 - INFO - [base] BEGIN (implicit)
2025-08-04 13:24:50,731 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:24:50,732 - INFO - [base] [generated in 0.00077s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:24:50,734 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:24:50,734 - INFO - [base] [cached since 0.003592s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:24:50,735 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:24:50,736 - INFO - [base] [cached since 0.005004s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:24:50,737 - INFO - [base] COMMIT
2025-08-04 13:24:51,109 - INFO - [dispatcher] Start polling
2025-08-04 13:24:51,159 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 13:32:44,751 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-04 13:32:44,752 - INFO - [base] BEGIN (implicit)
2025-08-04 13:32:44,758 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-04 13:32:44,759 - INFO - [base] [generated in 0.00055s] ('reddmon1',)
2025-08-04 13:32:44,763 - ERROR - [handlers] Ошибка в /start с реферальным кодом: A transaction is already begun on this Session.
2025-08-04 13:32:44,952 - INFO - [base] ROLLBACK
2025-08-04 13:32:44,953 - INFO - [dispatcher] Update id=433007716 is handled. Duration 203 ms by bot id=7524145939
2025-08-04 13:36:28,370 - INFO - [dispatcher] Polling stopped
2025-08-04 13:36:28,371 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 13:36:28,372 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 13:36:28,538 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 13:36:32,698 - INFO - [base] select pg_catalog.version()
2025-08-04 13:36:32,699 - INFO - [base] [raw sql] ()
2025-08-04 13:36:32,700 - INFO - [base] select current_schema()
2025-08-04 13:36:32,700 - INFO - [base] [raw sql] ()
2025-08-04 13:36:32,701 - INFO - [base] show standard_conforming_strings
2025-08-04 13:36:32,701 - INFO - [base] [raw sql] ()
2025-08-04 13:36:32,702 - INFO - [base] BEGIN (implicit)
2025-08-04 13:36:32,706 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:36:32,706 - INFO - [base] [generated in 0.00061s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:36:32,708 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:36:32,709 - INFO - [base] [cached since 0.003337s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:36:32,710 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 13:36:32,710 - INFO - [base] [cached since 0.004617s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 13:36:32,711 - INFO - [base] COMMIT
2025-08-04 13:36:33,003 - INFO - [dispatcher] Start polling
2025-08-04 13:36:33,041 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 13:36:34,890 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-04 13:36:34,891 - INFO - [base] BEGIN (implicit)
2025-08-04 13:36:34,897 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:36:34,898 - INFO - [base] [generated in 0.00047s] (7731533840,)
2025-08-04 13:36:34,900 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 13:36:34,901 - INFO - [base] [generated in 0.00046s] (7731533840, 'Неизвестный', '', None, datetime.datetime(2025, 8, 4, 10, 36, 34, 900855))
2025-08-04 13:36:34,905 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-04 13:36:34,905 - INFO - [base] [generated in 0.00045s] ('reddmon1',)
2025-08-04 13:36:35,067 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-08-04 13:36:35,068 - INFO - [base] [generated in 0.00046s] (1, 2)
2025-08-04 13:36:35,071 - INFO - [base] COMMIT
2025-08-04 13:36:35,072 - INFO - [dispatcher] Update id=433007717 is handled. Duration 186 ms by bot id=7524145939
2025-08-04 13:41:05,240 - INFO - [handlers] Обработка /help для пользователя 7731533840
2025-08-04 13:41:05,323 - INFO - [dispatcher] Update id=433007718 is handled. Duration 93 ms by bot id=7524145939
2025-08-04 13:41:07,126 - INFO - [handlers] Обработка /history для пользователя 7731533840
2025-08-04 13:41:07,127 - INFO - [base] BEGIN (implicit)
2025-08-04 13:41:07,127 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:41:07,128 - INFO - [base] [cached since 272.2s ago] (7731533840,)
2025-08-04 13:41:07,130 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 13:41:07,130 - INFO - [base] [generated in 0.00055s] (2, 10)
2025-08-04 13:41:07,253 - INFO - [base] COMMIT
2025-08-04 13:41:07,254 - INFO - [dispatcher] Update id=433007719 is handled. Duration 125 ms by bot id=7524145939
2025-08-04 13:41:10,447 - INFO - [handlers] Обработка /bonuses для пользователя 7731533840
2025-08-04 13:41:10,448 - INFO - [base] BEGIN (implicit)
2025-08-04 13:41:10,448 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:41:10,449 - INFO - [base] [cached since 275.6s ago] (7731533840,)
2025-08-04 13:41:10,450 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:41:10,451 - INFO - [base] [generated in 0.00043s] (2,)
2025-08-04 13:41:10,505 - INFO - [base] COMMIT
2025-08-04 13:41:10,506 - INFO - [dispatcher] Update id=433007720 is handled. Duration 46 ms by bot id=7524145939
2025-08-04 13:41:52,311 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 13:41:52,312 - INFO - [base] BEGIN (implicit)
2025-08-04 13:41:52,312 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:41:52,313 - INFO - [base] [cached since 317.4s ago] (1758719447,)
2025-08-04 13:41:52,314 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:41:52,315 - INFO - [base] [cached since 41.87s ago] (1,)
2025-08-04 13:41:52,317 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-08-04 13:41:52,318 - INFO - [base] [generated in 0.00099s] (2,)
2025-08-04 13:41:52,444 - INFO - [base] COMMIT
2025-08-04 13:41:52,445 - INFO - [dispatcher] Update id=433007721 is handled. Duration 140 ms by bot id=7524145939
2025-08-04 13:42:04,620 - INFO - [handlers] Обработка /start для пользователя 7731533840
2025-08-04 13:42:04,620 - INFO - [base] BEGIN (implicit)
2025-08-04 13:42:04,621 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:42:04,621 - INFO - [base] [cached since 329.7s ago] (7731533840,)
2025-08-04 13:42:04,622 - INFO - [base] COMMIT
2025-08-04 13:42:04,693 - INFO - [dispatcher] Update id=433007722 is handled. Duration 62 ms by bot id=7524145939
2025-08-04 13:42:44,335 - INFO - [handlers] Обработка /help для пользователя 1758719447
2025-08-04 13:42:44,512 - INFO - [dispatcher] Update id=433007723 is handled. Duration 188 ms by bot id=7524145939
2025-08-04 13:42:45,854 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 13:42:45,854 - INFO - [base] BEGIN (implicit)
2025-08-04 13:42:45,855 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:42:45,855 - INFO - [base] [cached since 371s ago] (1758719447,)
2025-08-04 13:42:45,856 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 13:42:45,857 - INFO - [base] [cached since 98.73s ago] (1, 10)
2025-08-04 13:42:46,000 - INFO - [base] COMMIT
2025-08-04 13:42:46,001 - INFO - [dispatcher] Update id=433007724 is handled. Duration 140 ms by bot id=7524145939
2025-08-04 13:42:47,917 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 13:42:47,917 - INFO - [base] BEGIN (implicit)
2025-08-04 13:42:47,917 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:42:47,918 - INFO - [base] [cached since 373s ago] (1758719447,)
2025-08-04 13:42:47,919 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 13:42:47,920 - INFO - [base] [cached since 100.8s ago] (1, 10)
2025-08-04 13:42:48,165 - INFO - [base] COMMIT
2025-08-04 13:42:48,166 - INFO - [dispatcher] Update id=433007725 is handled. Duration 250 ms by bot id=7524145939
2025-08-04 13:44:08,076 - INFO - [handlers] Обработка /history для пользователя 7731533840
2025-08-04 13:44:08,076 - INFO - [base] BEGIN (implicit)
2025-08-04 13:44:08,077 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:44:08,077 - INFO - [base] [cached since 453.2s ago] (7731533840,)
2025-08-04 13:44:08,078 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 13:44:08,079 - INFO - [base] [cached since 180.9s ago] (2, 10)
2025-08-04 13:44:08,166 - INFO - [base] COMMIT
2025-08-04 13:44:08,166 - INFO - [dispatcher] Update id=433007726 is handled. Duration 94 ms by bot id=7524145939
2025-08-04 13:44:10,526 - INFO - [handlers] Обработка /bonuses для пользователя 7731533840
2025-08-04 13:44:10,526 - INFO - [base] BEGIN (implicit)
2025-08-04 13:44:10,527 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:44:10,527 - INFO - [base] [cached since 455.6s ago] (7731533840,)
2025-08-04 13:44:10,528 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:44:10,528 - INFO - [base] [cached since 180.1s ago] (2,)
2025-08-04 13:44:10,588 - INFO - [base] COMMIT
2025-08-04 13:44:10,589 - INFO - [dispatcher] Update id=433007727 is handled. Duration 63 ms by bot id=7524145939
2025-08-04 13:44:15,728 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 13:44:15,728 - INFO - [base] BEGIN (implicit)
2025-08-04 13:44:15,729 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:44:15,729 - INFO - [base] [cached since 460.8s ago] (1758719447,)
2025-08-04 13:44:15,730 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:44:15,730 - INFO - [base] [cached since 185.3s ago] (1,)
2025-08-04 13:44:15,731 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-08-04 13:44:15,732 - INFO - [base] [cached since 143.4s ago] (2,)
2025-08-04 13:44:15,858 - INFO - [base] COMMIT
2025-08-04 13:44:15,859 - INFO - [dispatcher] Update id=433007728 is handled. Duration 125 ms by bot id=7524145939
2025-08-04 13:44:18,200 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 13:44:18,201 - INFO - [base] BEGIN (implicit)
2025-08-04 13:44:18,201 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:44:18,201 - INFO - [base] [cached since 463.3s ago] (1758719447,)
2025-08-04 13:44:18,203 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 13:44:18,203 - INFO - [base] [cached since 191.1s ago] (1, 10)
2025-08-04 13:44:18,261 - INFO - [base] COMMIT
2025-08-04 13:44:18,262 - INFO - [dispatcher] Update id=433007729 is handled. Duration 63 ms by bot id=7524145939
2025-08-04 13:44:24,022 - INFO - [dispatcher] Update id=433007730 is not handled. Duration 0 ms by bot id=7524145939
2025-08-04 13:44:24,023 - ERROR - [dispatcher] Cause exception while process update id=433007730 by bot id=7524145939
TypeError: bonus_received() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: bonus_received() missing 1 required positional argument: 'session'
2025-08-04 13:45:02,567 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 13:45:02,567 - INFO - [base] BEGIN (implicit)
2025-08-04 13:45:02,567 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:45:02,568 - INFO - [base] [cached since 507.7s ago] (1758719447,)
2025-08-04 13:45:02,569 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:45:02,569 - INFO - [base] [cached since 232.1s ago] (1,)
2025-08-04 13:45:02,570 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-08-04 13:45:02,571 - INFO - [base] [cached since 190.3s ago] (2,)
2025-08-04 13:45:02,678 - INFO - [base] COMMIT
2025-08-04 13:45:02,679 - INFO - [dispatcher] Update id=433007731 is handled. Duration 125 ms by bot id=7524145939
2025-08-04 13:45:27,193 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 13:45:27,193 - INFO - [base] BEGIN (implicit)
2025-08-04 13:45:27,194 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 13:45:27,194 - INFO - [base] [cached since 532.3s ago] (1758719447,)
2025-08-04 13:45:27,196 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.invited_by_id = $1::BIGINT
2025-08-04 13:45:27,196 - INFO - [base] [cached since 256.7s ago] (1,)
2025-08-04 13:45:27,197 - INFO - [base] SELECT purchases.id, purchases.user_id, purchases.name, purchases.amount, purchases.discount_applied, purchases.bonus_amount, purchases.date, purchases.bonus_paid 
FROM purchases 
WHERE purchases.user_id = $1::BIGINT
2025-08-04 13:45:27,197 - INFO - [base] [cached since 214.9s ago] (2,)
2025-08-04 13:45:27,350 - INFO - [base] COMMIT
2025-08-04 13:45:27,351 - INFO - [dispatcher] Update id=433007732 is handled. Duration 171 ms by bot id=7524145939
2025-08-04 13:59:46,078 - INFO - [dispatcher] Polling stopped
2025-08-04 13:59:46,079 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 13:59:46,079 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 13:59:46,266 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 14:00:22,651 - INFO - [base] select pg_catalog.version()
2025-08-04 14:00:22,651 - INFO - [base] [raw sql] ()
2025-08-04 14:00:22,653 - INFO - [base] select current_schema()
2025-08-04 14:00:22,653 - INFO - [base] [raw sql] ()
2025-08-04 14:00:22,654 - INFO - [base] show standard_conforming_strings
2025-08-04 14:00:22,654 - INFO - [base] [raw sql] ()
2025-08-04 14:00:22,655 - INFO - [base] BEGIN (implicit)
2025-08-04 14:00:22,658 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 14:00:22,658 - INFO - [base] [generated in 0.00084s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 14:00:22,661 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 14:00:22,662 - INFO - [base] [cached since 0.004582s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 14:00:22,663 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 14:00:22,664 - INFO - [base] [cached since 0.006257s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 14:00:22,665 - INFO - [base] COMMIT
2025-08-04 14:00:23,929 - INFO - [dispatcher] Start polling
2025-08-04 14:00:24,189 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 14:00:48,244 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:00:48,250 - INFO - [base] BEGIN (implicit)
2025-08-04 14:00:48,252 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:00:48,253 - INFO - [base] [generated in 0.00073s] (1758719447,)
2025-08-04 14:00:48,257 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:00:48,258 - INFO - [base] [generated in 0.00074s] (1,)
2025-08-04 14:00:48,261 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:00:48,261 - INFO - [base] [generated in 0.00071s] (2,)
2025-08-04 14:00:49,342 - INFO - [base] COMMIT
2025-08-04 14:00:49,343 - INFO - [dispatcher] Update id=433007733 is handled. Duration 1094 ms by bot id=7524145939
2025-08-04 14:01:22,408 - INFO - [handlers] Обработка /help для пользователя 1758719447
2025-08-04 14:01:22,696 - INFO - [dispatcher] Update id=433007734 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:01:24,024 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:01:24,024 - INFO - [base] BEGIN (implicit)
2025-08-04 14:01:24,025 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:01:24,025 - INFO - [base] [generated in 0.00048s] (1758719447,)
2025-08-04 14:01:24,027 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:01:24,028 - INFO - [base] [generated in 0.00056s] (1, 15)
2025-08-04 14:01:24,310 - INFO - [base] COMMIT
2025-08-04 14:01:24,311 - INFO - [dispatcher] Update id=433007735 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 14:01:40,755 - INFO - [handlers] Обработка /bonuses для пользователя 7731533840
2025-08-04 14:01:40,756 - INFO - [base] BEGIN (implicit)
2025-08-04 14:01:40,756 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:01:40,757 - INFO - [base] [cached since 52.51s ago] (7731533840,)
2025-08-04 14:01:40,758 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:01:40,758 - INFO - [base] [cached since 52.5s ago] (2,)
2025-08-04 14:01:41,039 - INFO - [base] COMMIT
2025-08-04 14:01:41,040 - INFO - [dispatcher] Update id=433007736 is handled. Duration 297 ms by bot id=7524145939
2025-08-04 14:01:46,181 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:01:46,181 - INFO - [base] BEGIN (implicit)
2025-08-04 14:01:46,182 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:01:46,182 - INFO - [base] [cached since 57.93s ago] (1758719447,)
2025-08-04 14:01:46,184 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:01:46,184 - INFO - [base] [cached since 57.93s ago] (1,)
2025-08-04 14:01:46,186 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:01:46,186 - INFO - [base] [cached since 57.93s ago] (2,)
2025-08-04 14:01:46,468 - INFO - [base] COMMIT
2025-08-04 14:01:46,469 - INFO - [dispatcher] Update id=433007737 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 14:01:48,286 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:01:48,286 - INFO - [base] BEGIN (implicit)
2025-08-04 14:01:48,287 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:01:48,287 - INFO - [base] [cached since 24.26s ago] (1758719447,)
2025-08-04 14:01:48,289 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:01:48,289 - INFO - [base] [cached since 24.26s ago] (1, 15)
2025-08-04 14:01:48,719 - INFO - [base] COMMIT
2025-08-04 14:01:48,720 - INFO - [dispatcher] Update id=433007738 is handled. Duration 438 ms by bot id=7524145939
2025-08-04 14:04:21,535 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:04:21,536 - INFO - [base] BEGIN (implicit)
2025-08-04 14:04:21,536 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:04:21,537 - INFO - [base] [cached since 177.5s ago] (1758719447,)
2025-08-04 14:04:21,538 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:04:21,538 - INFO - [base] [cached since 177.5s ago] (1, 15)
2025-08-04 14:04:21,822 - INFO - [base] COMMIT
2025-08-04 14:04:21,823 - INFO - [dispatcher] Update id=433007739 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:04:23,398 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:04:23,398 - INFO - [base] BEGIN (implicit)
2025-08-04 14:04:23,399 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:04:23,399 - INFO - [base] [cached since 215.1s ago] (1758719447,)
2025-08-04 14:04:23,401 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:04:23,401 - INFO - [base] [cached since 215.1s ago] (1,)
2025-08-04 14:04:23,402 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:04:23,403 - INFO - [base] [cached since 215.1s ago] (2,)
2025-08-04 14:04:23,682 - INFO - [base] COMMIT
2025-08-04 14:04:23,683 - INFO - [dispatcher] Update id=433007740 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:04:26,055 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:04:26,055 - INFO - [base] BEGIN (implicit)
2025-08-04 14:04:26,056 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:04:26,056 - INFO - [base] [cached since 182s ago] (1758719447,)
2025-08-04 14:04:26,057 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:04:26,058 - INFO - [base] [cached since 182s ago] (1, 15)
2025-08-04 14:04:26,341 - INFO - [base] COMMIT
2025-08-04 14:04:26,342 - INFO - [dispatcher] Update id=433007741 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:12:18,970 - INFO - [handlers] Обработка /history для пользователя 7731533840
2025-08-04 14:12:18,971 - INFO - [base] BEGIN (implicit)
2025-08-04 14:12:18,972 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:12:18,973 - INFO - [base] [cached since 654.9s ago] (7731533840,)
2025-08-04 14:12:18,974 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:12:18,975 - INFO - [base] [cached since 654.9s ago] (2, 15)
2025-08-04 14:12:19,261 - INFO - [base] COMMIT
2025-08-04 14:12:19,262 - INFO - [dispatcher] Update id=433007742 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:12:24,913 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:12:24,915 - INFO - [base] BEGIN (implicit)
2025-08-04 14:12:24,915 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:12:24,916 - INFO - [base] [cached since 660.9s ago] (1758719447,)
2025-08-04 14:12:24,919 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:12:24,924 - INFO - [base] [cached since 660.9s ago] (1, 15)
2025-08-04 14:12:25,303 - INFO - [base] COMMIT
2025-08-04 14:12:25,304 - INFO - [dispatcher] Update id=433007743 is handled. Duration 406 ms by bot id=7524145939
2025-08-04 14:12:35,058 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:12:35,059 - INFO - [base] BEGIN (implicit)
2025-08-04 14:12:35,059 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:12:35,060 - INFO - [base] [cached since 706.8s ago] (1758719447,)
2025-08-04 14:12:35,061 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:12:35,062 - INFO - [base] [cached since 706.8s ago] (1,)
2025-08-04 14:12:35,063 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:12:35,064 - INFO - [base] [cached since 706.8s ago] (2,)
2025-08-04 14:12:35,403 - INFO - [base] COMMIT
2025-08-04 14:12:35,404 - INFO - [dispatcher] Update id=433007744 is handled. Duration 343 ms by bot id=7524145939
2025-08-04 14:13:19,661 - INFO - [dispatcher] Update id=433007745 is not handled. Duration 0 ms by bot id=7524145939
2025-08-04 14:13:19,661 - ERROR - [dispatcher] Cause exception while process update id=433007745 by bot id=7524145939
TypeError: bonus_received_callback() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\vlad\Desktop\Parser_project\ReferalBot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
                 ^^^^^^^^^
TypeError: bonus_received_callback() missing 1 required positional argument: 'session'
2025-08-04 14:17:02,573 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:17:02,573 - INFO - [base] BEGIN (implicit)
2025-08-04 14:17:02,574 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:17:02,575 - INFO - [base] [cached since 938.5s ago] (1758719447,)
2025-08-04 14:17:02,576 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:17:02,576 - INFO - [base] [cached since 938.5s ago] (1, 15)
2025-08-04 14:17:02,865 - INFO - [base] COMMIT
2025-08-04 14:17:02,866 - INFO - [dispatcher] Update id=433007746 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:17:25,645 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:17:25,645 - INFO - [base] BEGIN (implicit)
2025-08-04 14:17:25,646 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:17:25,646 - INFO - [base] [cached since 961.6s ago] (1758719447,)
2025-08-04 14:17:25,647 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:17:25,648 - INFO - [base] [cached since 961.6s ago] (1, 15)
2025-08-04 14:17:25,926 - INFO - [base] COMMIT
2025-08-04 14:17:25,927 - INFO - [dispatcher] Update id=433007747 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 14:54:03,541 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 14:54:03,541 - INFO - [base] BEGIN (implicit)
2025-08-04 14:54:03,542 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:54:03,542 - INFO - [base] [cached since 3160s ago] (1758719447,)
2025-08-04 14:54:03,543 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 14:54:03,544 - INFO - [base] [cached since 3160s ago] (1, 15)
2025-08-04 14:54:04,338 - INFO - [base] COMMIT
2025-08-04 14:54:04,339 - INFO - [dispatcher] Update id=433007748 is handled. Duration 796 ms by bot id=7524145939
2025-08-04 14:54:09,142 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:54:09,143 - INFO - [base] BEGIN (implicit)
2025-08-04 14:54:09,143 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:54:09,144 - INFO - [base] [cached since 3201s ago] (1758719447,)
2025-08-04 14:54:09,145 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:54:09,145 - INFO - [base] [cached since 3201s ago] (1,)
2025-08-04 14:54:09,148 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:54:09,148 - INFO - [base] [cached since 3201s ago] (2,)
2025-08-04 14:54:09,479 - INFO - [base] COMMIT
2025-08-04 14:54:09,480 - INFO - [dispatcher] Update id=433007749 is handled. Duration 343 ms by bot id=7524145939
2025-08-04 14:54:20,388 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:54:20,389 - INFO - [base] BEGIN (implicit)
2025-08-04 14:54:20,389 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:54:20,390 - INFO - [base] [cached since 3212s ago] (1758719447,)
2025-08-04 14:54:20,391 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:54:20,391 - INFO - [base] [cached since 3212s ago] (1,)
2025-08-04 14:54:20,392 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:54:20,393 - INFO - [base] [cached since 3212s ago] (2,)
2025-08-04 14:54:20,719 - INFO - [base] COMMIT
2025-08-04 14:54:20,720 - INFO - [dispatcher] Update id=433007750 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 14:54:39,483 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:54:39,484 - INFO - [base] BEGIN (implicit)
2025-08-04 14:54:39,484 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:54:39,485 - INFO - [base] [cached since 3231s ago] (1758719447,)
2025-08-04 14:54:39,486 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:54:39,486 - INFO - [base] [cached since 3231s ago] (1,)
2025-08-04 14:54:39,487 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:54:39,487 - INFO - [base] [cached since 3231s ago] (2,)
2025-08-04 14:54:39,772 - INFO - [base] COMMIT
2025-08-04 14:54:39,773 - INFO - [dispatcher] Update id=433007751 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 14:55:08,267 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 14:55:08,267 - INFO - [base] BEGIN (implicit)
2025-08-04 14:55:08,268 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 14:55:08,268 - INFO - [base] [cached since 3260s ago] (1758719447,)
2025-08-04 14:55:08,269 - INFO - [base] SELECT users.invited_by_id AS users_invited_by_id, users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.promo_code AS users_promo_code, users.created_at AS users_created_at 
FROM users 
WHERE users.invited_by_id IN ($1::BIGINT)
2025-08-04 14:55:08,270 - INFO - [base] [cached since 3260s ago] (1,)
2025-08-04 14:55:08,271 - INFO - [base] SELECT purchases.user_id AS purchases_user_id, purchases.id AS purchases_id, purchases.name AS purchases_name, purchases.amount AS purchases_amount, purchases.discount_applied AS purchases_discount_applied, purchases.bonus_amount AS purchases_bonus_amount, purchases.date AS purchases_date, purchases.bonus_paid AS purchases_bonus_paid 
FROM purchases 
WHERE purchases.user_id IN ($1::BIGINT)
2025-08-04 14:55:08,271 - INFO - [base] [cached since 3260s ago] (2,)
2025-08-04 14:55:08,634 - INFO - [base] COMMIT
2025-08-04 14:55:08,634 - INFO - [dispatcher] Update id=433007752 is handled. Duration 375 ms by bot id=7524145939
2025-08-04 15:02:46,438 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 15:02:46,439 - INFO - [base] BEGIN (implicit)
2025-08-04 15:02:46,439 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:02:46,440 - INFO - [base] [cached since 3682s ago] (1758719447,)
2025-08-04 15:02:46,441 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 15:02:46,441 - INFO - [base] [cached since 3682s ago] (1, 15)
2025-08-04 15:02:46,743 - INFO - [base] COMMIT
2025-08-04 15:02:46,743 - INFO - [dispatcher] Update id=433007753 is handled. Duration 312 ms by bot id=7524145939
2025-08-04 15:22:36,545 - INFO - [dispatcher] Polling stopped
2025-08-04 15:22:36,546 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 15:22:36,546 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 15:22:36,801 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:22:42,260 - INFO - [base] select pg_catalog.version()
2025-08-04 15:22:42,261 - INFO - [base] [raw sql] ()
2025-08-04 15:22:42,262 - INFO - [base] select current_schema()
2025-08-04 15:22:42,262 - INFO - [base] [raw sql] ()
2025-08-04 15:22:42,263 - INFO - [base] show standard_conforming_strings
2025-08-04 15:22:42,263 - INFO - [base] [raw sql] ()
2025-08-04 15:22:42,264 - INFO - [base] BEGIN (implicit)
2025-08-04 15:22:42,267 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:22:42,268 - INFO - [base] [generated in 0.00074s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:22:42,270 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:22:42,270 - INFO - [base] [cached since 0.003376s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:22:42,271 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:22:42,271 - INFO - [base] [cached since 0.004443s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:22:42,272 - INFO - [base] COMMIT
2025-08-04 15:22:43,487 - INFO - [dispatcher] Start polling
2025-08-04 15:22:43,749 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:27:45,259 - INFO - [dispatcher] Polling stopped
2025-08-04 15:27:45,259 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 15:27:45,260 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 15:27:45,517 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:27:53,542 - INFO - [base] select pg_catalog.version()
2025-08-04 15:27:53,542 - INFO - [base] [raw sql] ()
2025-08-04 15:27:53,544 - INFO - [base] select current_schema()
2025-08-04 15:27:53,544 - INFO - [base] [raw sql] ()
2025-08-04 15:27:53,545 - INFO - [base] show standard_conforming_strings
2025-08-04 15:27:53,545 - INFO - [base] [raw sql] ()
2025-08-04 15:27:53,546 - INFO - [base] BEGIN (implicit)
2025-08-04 15:27:53,550 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:27:53,550 - INFO - [base] [generated in 0.00065s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:27:53,552 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:27:53,553 - INFO - [base] [cached since 0.003275s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:27:53,554 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:27:53,554 - INFO - [base] [cached since 0.004437s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:27:53,555 - INFO - [base] COMMIT
2025-08-04 15:27:54,728 - INFO - [dispatcher] Start polling
2025-08-04 15:27:54,987 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:30:07,675 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 15:30:07,676 - INFO - [base] BEGIN (implicit)
2025-08-04 15:30:07,682 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:30:07,682 - INFO - [base] [generated in 0.00049s] (1758719447,)
2025-08-04 15:30:07,684 - INFO - [base] ROLLBACK
2025-08-04 15:30:07,684 - ERROR - [handlers] Ошибка в /bonuses: name 'func' is not defined
2025-08-04 15:30:08,793 - INFO - [dispatcher] Update id=433007754 is handled. Duration 1125 ms by bot id=7524145939
2025-08-04 15:30:46,562 - INFO - [dispatcher] Polling stopped
2025-08-04 15:30:46,563 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 15:30:46,563 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 15:30:46,749 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:30:52,221 - INFO - [base] select pg_catalog.version()
2025-08-04 15:30:52,221 - INFO - [base] [raw sql] ()
2025-08-04 15:30:52,223 - INFO - [base] select current_schema()
2025-08-04 15:30:52,223 - INFO - [base] [raw sql] ()
2025-08-04 15:30:52,224 - INFO - [base] show standard_conforming_strings
2025-08-04 15:30:52,224 - INFO - [base] [raw sql] ()
2025-08-04 15:30:52,225 - INFO - [base] BEGIN (implicit)
2025-08-04 15:30:52,227 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:30:52,228 - INFO - [base] [generated in 0.00078s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:30:52,230 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:30:52,231 - INFO - [base] [cached since 0.003481s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:30:52,232 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:30:52,232 - INFO - [base] [cached since 0.0047s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:30:52,233 - INFO - [base] COMMIT
2025-08-04 15:30:53,418 - INFO - [dispatcher] Start polling
2025-08-04 15:30:53,679 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:30:53,941 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 15:30:53,942 - INFO - [base] BEGIN (implicit)
2025-08-04 15:30:53,948 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:30:53,948 - INFO - [base] [generated in 0.00044s] (1758719447,)
2025-08-04 15:30:53,951 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 15:30:53,951 - INFO - [base] [generated in 0.00046s] (1,)
2025-08-04 15:30:55,009 - INFO - [base] COMMIT
2025-08-04 15:30:55,010 - INFO - [dispatcher] Update id=433007755 is handled. Duration 1078 ms by bot id=7524145939
2025-08-04 15:31:18,693 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 15:31:18,694 - INFO - [base] BEGIN (implicit)
2025-08-04 15:31:18,695 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:31:18,696 - INFO - [base] [generated in 0.00043s] (1758719447,)
2025-08-04 15:31:18,698 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 15:31:18,698 - INFO - [base] [generated in 0.00053s] (1,)
2025-08-04 15:31:18,700 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 15:31:18,701 - INFO - [base] [generated in 0.00049s] (1, 15)
2025-08-04 15:31:19,007 - INFO - [base] COMMIT
2025-08-04 15:31:19,007 - INFO - [dispatcher] Update id=433007756 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 15:32:32,209 - INFO - [dispatcher] Polling stopped
2025-08-04 15:32:32,210 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 15:32:32,210 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 15:32:32,396 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:32:56,708 - INFO - [base] select pg_catalog.version()
2025-08-04 15:32:56,709 - INFO - [base] [raw sql] ()
2025-08-04 15:32:56,710 - INFO - [base] select current_schema()
2025-08-04 15:32:56,710 - INFO - [base] [raw sql] ()
2025-08-04 15:32:56,711 - INFO - [base] show standard_conforming_strings
2025-08-04 15:32:56,711 - INFO - [base] [raw sql] ()
2025-08-04 15:32:56,712 - INFO - [base] BEGIN (implicit)
2025-08-04 15:32:56,715 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:32:56,716 - INFO - [base] [generated in 0.00060s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:32:56,718 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:32:56,719 - INFO - [base] [cached since 0.003715s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:32:56,720 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 15:32:56,720 - INFO - [base] [cached since 0.00502s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 15:32:56,721 - INFO - [base] COMMIT
2025-08-04 15:32:57,916 - INFO - [dispatcher] Start polling
2025-08-04 15:32:58,175 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 15:33:40,258 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 15:33:40,259 - INFO - [base] BEGIN (implicit)
2025-08-04 15:33:40,265 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:33:40,266 - INFO - [base] [generated in 0.00072s] (1758719447,)
2025-08-04 15:33:41,327 - INFO - [base] COMMIT
2025-08-04 15:33:41,328 - INFO - [dispatcher] Update id=433007757 is handled. Duration 1061 ms by bot id=7524145939
2025-08-04 15:33:42,810 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 15:33:42,810 - INFO - [base] BEGIN (implicit)
2025-08-04 15:33:42,811 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:33:42,812 - INFO - [base] [generated in 0.00047s] (1758719447,)
2025-08-04 15:33:42,815 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 15:33:42,815 - INFO - [base] [generated in 0.00052s] (1758719447, 'reddmon1', 'reddmon1', None, datetime.datetime(2025, 8, 4, 12, 33, 42, 815555))
2025-08-04 15:33:42,817 - INFO - [base] COMMIT
2025-08-04 15:33:43,124 - INFO - [dispatcher] Update id=433007758 is handled. Duration 312 ms by bot id=7524145939
2025-08-04 15:33:45,046 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 15:33:45,047 - INFO - [base] BEGIN (implicit)
2025-08-04 15:33:45,047 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:33:45,048 - INFO - [base] [cached since 4.783s ago] (1758719447,)
2025-08-04 15:33:45,050 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 15:33:45,050 - INFO - [base] [generated in 0.00046s] (1,)
2025-08-04 15:33:45,335 - INFO - [base] COMMIT
2025-08-04 15:33:45,336 - INFO - [dispatcher] Update id=433007759 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 15:33:53,087 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 15:33:53,087 - INFO - [base] BEGIN (implicit)
2025-08-04 15:33:53,088 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:33:53,088 - INFO - [base] [cached since 10.28s ago] (1758719447,)
2025-08-04 15:33:53,091 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 15:33:53,091 - INFO - [base] [generated in 0.00057s] (1,)
2025-08-04 15:33:53,093 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 15:33:53,094 - INFO - [base] [generated in 0.00065s] (1, 15)
2025-08-04 15:33:53,501 - INFO - [base] COMMIT
2025-08-04 15:33:53,502 - INFO - [dispatcher] Update id=433007760 is handled. Duration 405 ms by bot id=7524145939
2025-08-04 15:39:54,718 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-04 15:39:54,718 - INFO - [base] BEGIN (implicit)
2025-08-04 15:39:54,719 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:39:54,719 - INFO - [base] [cached since 371.9s ago] (7731533840,)
2025-08-04 15:39:54,721 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 15:39:54,721 - INFO - [base] [cached since 371.9s ago] (7731533840, 'Неизвестный', '', None, datetime.datetime(2025, 8, 4, 12, 39, 54, 721998))
2025-08-04 15:39:54,722 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-04 15:39:54,723 - INFO - [base] [generated in 0.00042s] ('reddmon1',)
2025-08-04 15:39:54,724 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 15:39:54,725 - INFO - [base] [cached since 361.6s ago] (1,)
2025-08-04 15:39:55,100 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-08-04 15:39:55,100 - INFO - [base] [generated in 0.00042s] (1, 2)
2025-08-04 15:39:55,101 - INFO - [base] COMMIT
2025-08-04 15:39:55,102 - INFO - [dispatcher] Update id=433007761 is handled. Duration 389 ms by bot id=7524145939
2025-08-04 15:40:48,621 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 15:40:48,621 - INFO - [base] BEGIN (implicit)
2025-08-04 15:40:48,622 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 15:40:48,622 - INFO - [base] [cached since 425.8s ago] (1758719447,)
2025-08-04 15:40:48,624 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 15:40:48,624 - INFO - [base] [cached since 415.5s ago] (1,)
2025-08-04 15:40:48,625 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 15:40:48,626 - INFO - [base] [cached since 415.5s ago] (1, 15)
2025-08-04 15:40:48,908 - INFO - [base] COMMIT
2025-08-04 15:40:48,908 - INFO - [dispatcher] Update id=433007762 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 15:54:19,461 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 15:54:19,462 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 15:54:31,242 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-08-04 16:17:00,995 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 16:17:00,995 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 16:17:12,760 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-08-04 16:20:27,617 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 16:20:27,618 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 16:20:39,651 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-08-04 17:33:21,123 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:33:21,124 - INFO - [base] BEGIN (implicit)
2025-08-04 17:33:21,124 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:33:21,125 - INFO - [base] [cached since 7178s ago] (1758719447,)
2025-08-04 17:33:21,126 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:33:21,126 - INFO - [base] [cached since 7168s ago] (1,)
2025-08-04 17:33:21,127 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:33:21,128 - INFO - [base] [cached since 7168s ago] (1, 15)
2025-08-04 17:33:21,937 - INFO - [base] COMMIT
2025-08-04 17:33:21,938 - INFO - [dispatcher] Update id=433007763 is handled. Duration 812 ms by bot id=7524145939
2025-08-04 17:33:23,586 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:33:23,587 - INFO - [base] BEGIN (implicit)
2025-08-04 17:33:23,587 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:33:23,588 - INFO - [base] [cached since 7183s ago] (1758719447,)
2025-08-04 17:33:23,589 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:33:23,589 - INFO - [base] [cached since 7179s ago] (1,)
2025-08-04 17:33:23,898 - INFO - [base] COMMIT
2025-08-04 17:33:23,899 - INFO - [dispatcher] Update id=433007764 is handled. Duration 311 ms by bot id=7524145939
2025-08-04 17:33:41,480 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:33:41,481 - INFO - [base] BEGIN (implicit)
2025-08-04 17:33:41,481 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:33:41,482 - INFO - [base] [cached since 7201s ago] (1758719447,)
2025-08-04 17:33:41,483 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:33:41,483 - INFO - [base] [cached since 7196s ago] (1,)
2025-08-04 17:33:41,782 - INFO - [base] COMMIT
2025-08-04 17:33:41,782 - INFO - [dispatcher] Update id=433007765 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:33:43,190 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:33:43,191 - INFO - [base] BEGIN (implicit)
2025-08-04 17:33:43,191 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:33:43,192 - INFO - [base] [cached since 7200s ago] (1758719447,)
2025-08-04 17:33:43,193 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:33:43,194 - INFO - [base] [cached since 7190s ago] (1,)
2025-08-04 17:33:43,195 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:33:43,195 - INFO - [base] [cached since 7190s ago] (1, 15)
2025-08-04 17:33:43,492 - INFO - [base] COMMIT
2025-08-04 17:33:43,493 - INFO - [dispatcher] Update id=433007766 is handled. Duration 312 ms by bot id=7524145939
2025-08-04 17:34:11,064 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:34:11,064 - INFO - [base] BEGIN (implicit)
2025-08-04 17:34:11,065 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:34:11,065 - INFO - [base] [cached since 7228s ago] (1758719447,)
2025-08-04 17:34:11,066 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:34:11,067 - INFO - [base] [cached since 7218s ago] (1,)
2025-08-04 17:34:11,068 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:34:11,068 - INFO - [base] [cached since 7218s ago] (1, 15)
2025-08-04 17:34:11,396 - INFO - [base] COMMIT
2025-08-04 17:34:11,396 - INFO - [dispatcher] Update id=433007767 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 17:34:36,231 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:34:36,232 - INFO - [base] BEGIN (implicit)
2025-08-04 17:34:36,232 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:34:36,233 - INFO - [base] [cached since 7253s ago] (1758719447,)
2025-08-04 17:34:36,234 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:34:36,234 - INFO - [base] [cached since 7243s ago] (1,)
2025-08-04 17:34:36,235 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:34:36,236 - INFO - [base] [cached since 7243s ago] (1, 15)
2025-08-04 17:34:36,640 - INFO - [base] COMMIT
2025-08-04 17:34:36,641 - INFO - [dispatcher] Update id=433007768 is handled. Duration 406 ms by bot id=7524145939
2025-08-04 17:34:46,745 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:34:46,746 - INFO - [base] BEGIN (implicit)
2025-08-04 17:34:46,746 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:34:46,746 - INFO - [base] [cached since 7264s ago] (1758719447,)
2025-08-04 17:34:46,748 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:34:46,748 - INFO - [base] [cached since 7254s ago] (1,)
2025-08-04 17:34:46,749 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:34:46,750 - INFO - [base] [cached since 7254s ago] (1, 15)
2025-08-04 17:34:47,150 - INFO - [base] COMMIT
2025-08-04 17:34:47,151 - INFO - [dispatcher] Update id=433007769 is handled. Duration 406 ms by bot id=7524145939
2025-08-04 17:34:50,067 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:34:50,068 - INFO - [base] BEGIN (implicit)
2025-08-04 17:34:50,068 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:34:50,069 - INFO - [base] [cached since 7270s ago] (1758719447,)
2025-08-04 17:34:50,070 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:34:50,071 - INFO - [base] [cached since 7265s ago] (1,)
2025-08-04 17:34:50,350 - INFO - [base] COMMIT
2025-08-04 17:34:50,351 - INFO - [dispatcher] Update id=433007770 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:35:14,991 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:35:14,992 - INFO - [base] BEGIN (implicit)
2025-08-04 17:35:14,992 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:35:14,992 - INFO - [base] [cached since 7295s ago] (1758719447,)
2025-08-04 17:35:14,994 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:35:14,994 - INFO - [base] [cached since 7290s ago] (1,)
2025-08-04 17:35:15,299 - INFO - [base] COMMIT
2025-08-04 17:35:15,300 - INFO - [dispatcher] Update id=433007771 is handled. Duration 313 ms by bot id=7524145939
2025-08-04 17:35:23,878 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:35:23,879 - INFO - [base] BEGIN (implicit)
2025-08-04 17:35:23,879 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:35:23,880 - INFO - [base] [cached since 7304s ago] (1758719447,)
2025-08-04 17:35:23,881 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:35:23,881 - INFO - [base] [cached since 7299s ago] (1,)
2025-08-04 17:35:24,230 - INFO - [base] COMMIT
2025-08-04 17:35:24,230 - INFO - [dispatcher] Update id=433007772 is handled. Duration 359 ms by bot id=7524145939
2025-08-04 17:35:30,337 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:35:30,338 - INFO - [base] BEGIN (implicit)
2025-08-04 17:35:30,338 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:35:30,338 - INFO - [base] [cached since 7308s ago] (1758719447,)
2025-08-04 17:35:30,339 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:35:30,340 - INFO - [base] [cached since 7297s ago] (1,)
2025-08-04 17:35:30,341 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:35:30,342 - INFO - [base] [cached since 7297s ago] (1, 15)
2025-08-04 17:35:30,653 - INFO - [base] COMMIT
2025-08-04 17:35:30,654 - INFO - [dispatcher] Update id=433007773 is handled. Duration 311 ms by bot id=7524145939
2025-08-04 17:36:09,799 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:36:09,799 - INFO - [base] BEGIN (implicit)
2025-08-04 17:36:09,800 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:36:09,800 - INFO - [base] [cached since 7347s ago] (1758719447,)
2025-08-04 17:36:09,801 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:36:09,802 - INFO - [base] [cached since 7337s ago] (1,)
2025-08-04 17:36:09,803 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:36:09,803 - INFO - [base] [cached since 7337s ago] (1, 15)
2025-08-04 17:36:10,149 - INFO - [base] COMMIT
2025-08-04 17:36:10,150 - INFO - [dispatcher] Update id=433007774 is handled. Duration 358 ms by bot id=7524145939
2025-08-04 17:46:54,297 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:46:54,298 - INFO - [base] BEGIN (implicit)
2025-08-04 17:46:54,298 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:46:54,298 - INFO - [base] [cached since 7994s ago] (1758719447,)
2025-08-04 17:46:54,299 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:46:54,300 - INFO - [base] [cached since 7989s ago] (1,)
2025-08-04 17:46:54,579 - INFO - [base] COMMIT
2025-08-04 17:46:54,580 - INFO - [dispatcher] Update id=433007775 is handled. Duration 280 ms by bot id=7524145939
2025-08-04 17:47:21,204 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:47:21,204 - INFO - [base] BEGIN (implicit)
2025-08-04 17:47:21,205 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:47:21,205 - INFO - [base] [cached since 8021s ago] (1758719447,)
2025-08-04 17:47:21,206 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:47:21,207 - INFO - [base] [cached since 8016s ago] (1,)
2025-08-04 17:47:21,489 - INFO - [base] COMMIT
2025-08-04 17:47:21,490 - INFO - [dispatcher] Update id=433007776 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 17:47:51,018 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:47:51,019 - INFO - [base] BEGIN (implicit)
2025-08-04 17:47:51,019 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:47:51,019 - INFO - [base] [cached since 8051s ago] (1758719447,)
2025-08-04 17:47:51,020 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:47:51,021 - INFO - [base] [cached since 8046s ago] (1,)
2025-08-04 17:47:51,351 - INFO - [base] COMMIT
2025-08-04 17:47:51,352 - INFO - [dispatcher] Update id=433007777 is handled. Duration 343 ms by bot id=7524145939
2025-08-04 17:48:06,645 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:48:06,646 - INFO - [base] BEGIN (implicit)
2025-08-04 17:48:06,646 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:48:06,647 - INFO - [base] [cached since 8066s ago] (1758719447,)
2025-08-04 17:48:06,648 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:48:06,648 - INFO - [base] [cached since 8062s ago] (1,)
2025-08-04 17:48:06,931 - INFO - [base] COMMIT
2025-08-04 17:48:06,932 - INFO - [dispatcher] Update id=433007778 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:48:51,597 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:48:51,597 - INFO - [base] BEGIN (implicit)
2025-08-04 17:48:51,598 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:48:51,598 - INFO - [base] [cached since 8111s ago] (1758719447,)
2025-08-04 17:48:51,599 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:48:51,599 - INFO - [base] [cached since 8107s ago] (1,)
2025-08-04 17:48:51,877 - INFO - [base] COMMIT
2025-08-04 17:48:51,878 - INFO - [dispatcher] Update id=433007779 is handled. Duration 280 ms by bot id=7524145939
2025-08-04 17:49:01,616 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:49:01,616 - INFO - [base] BEGIN (implicit)
2025-08-04 17:49:01,617 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:49:01,617 - INFO - [base] [cached since 8121s ago] (1758719447,)
2025-08-04 17:49:01,618 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:49:01,619 - INFO - [base] [cached since 8117s ago] (1,)
2025-08-04 17:49:01,969 - INFO - [base] COMMIT
2025-08-04 17:49:01,969 - INFO - [dispatcher] Update id=433007780 is handled. Duration 360 ms by bot id=7524145939
2025-08-04 17:49:05,089 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:49:05,089 - INFO - [base] BEGIN (implicit)
2025-08-04 17:49:05,090 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:49:05,090 - INFO - [base] [cached since 8122s ago] (1758719447,)
2025-08-04 17:49:05,091 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:49:05,092 - INFO - [base] [cached since 8112s ago] (1,)
2025-08-04 17:49:05,094 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:49:05,095 - INFO - [base] [cached since 8112s ago] (1, 15)
2025-08-04 17:49:05,395 - INFO - [base] COMMIT
2025-08-04 17:49:05,396 - INFO - [dispatcher] Update id=433007781 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:49:17,411 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:49:17,411 - INFO - [base] BEGIN (implicit)
2025-08-04 17:49:17,412 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:49:17,412 - INFO - [base] [cached since 8135s ago] (1758719447,)
2025-08-04 17:49:17,413 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:49:17,414 - INFO - [base] [cached since 8124s ago] (1,)
2025-08-04 17:49:17,415 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:49:17,415 - INFO - [base] [cached since 8124s ago] (1, 15)
2025-08-04 17:49:17,711 - INFO - [base] COMMIT
2025-08-04 17:49:17,712 - INFO - [dispatcher] Update id=433007782 is handled. Duration 313 ms by bot id=7524145939
2025-08-04 17:49:22,009 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:49:22,010 - INFO - [base] BEGIN (implicit)
2025-08-04 17:49:22,010 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:49:22,011 - INFO - [base] [cached since 8142s ago] (1758719447,)
2025-08-04 17:49:22,012 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:49:22,012 - INFO - [base] [cached since 8137s ago] (1,)
2025-08-04 17:49:22,392 - INFO - [base] COMMIT
2025-08-04 17:49:22,393 - INFO - [dispatcher] Update id=433007783 is handled. Duration 375 ms by bot id=7524145939
2025-08-04 17:50:07,475 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:50:07,475 - INFO - [base] BEGIN (implicit)
2025-08-04 17:50:07,476 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:50:07,476 - INFO - [base] [cached since 8187s ago] (1758719447,)
2025-08-04 17:50:07,477 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:50:07,478 - INFO - [base] [cached since 8182s ago] (1,)
2025-08-04 17:50:07,755 - INFO - [base] COMMIT
2025-08-04 17:50:07,755 - INFO - [dispatcher] Update id=433007784 is handled. Duration 280 ms by bot id=7524145939
2025-08-04 17:50:16,568 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:50:16,569 - INFO - [base] BEGIN (implicit)
2025-08-04 17:50:16,570 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:50:16,570 - INFO - [base] [cached since 8196s ago] (1758719447,)
2025-08-04 17:50:16,571 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:50:16,571 - INFO - [base] [cached since 8192s ago] (1,)
2025-08-04 17:50:16,863 - INFO - [base] COMMIT
2025-08-04 17:50:16,864 - INFO - [dispatcher] Update id=433007785 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:52:01,810 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:52:01,811 - INFO - [base] BEGIN (implicit)
2025-08-04 17:52:01,811 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:52:01,812 - INFO - [base] [cached since 8302s ago] (1758719447,)
2025-08-04 17:52:01,813 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:52:01,813 - INFO - [base] [cached since 8297s ago] (1,)
2025-08-04 17:52:02,125 - INFO - [base] COMMIT
2025-08-04 17:52:02,126 - INFO - [dispatcher] Update id=433007786 is handled. Duration 312 ms by bot id=7524145939
2025-08-04 17:52:21,298 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:52:21,299 - INFO - [base] BEGIN (implicit)
2025-08-04 17:52:21,299 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:52:21,300 - INFO - [base] [cached since 8321s ago] (1758719447,)
2025-08-04 17:52:21,301 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:52:21,301 - INFO - [base] [cached since 8316s ago] (1,)
2025-08-04 17:52:21,592 - INFO - [base] COMMIT
2025-08-04 17:52:21,593 - INFO - [dispatcher] Update id=433007787 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:52:28,400 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:52:28,400 - INFO - [base] BEGIN (implicit)
2025-08-04 17:52:28,401 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:52:28,401 - INFO - [base] [cached since 8326s ago] (1758719447,)
2025-08-04 17:52:28,402 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:52:28,403 - INFO - [base] [cached since 8315s ago] (1,)
2025-08-04 17:52:28,404 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:52:28,405 - INFO - [base] [cached since 8315s ago] (1, 15)
2025-08-04 17:52:28,691 - INFO - [base] COMMIT
2025-08-04 17:52:28,692 - INFO - [dispatcher] Update id=433007788 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 17:54:11,691 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:54:11,692 - INFO - [base] BEGIN (implicit)
2025-08-04 17:54:11,692 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:54:11,692 - INFO - [base] [cached since 8429s ago] (1758719447,)
2025-08-04 17:54:11,693 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:54:11,694 - INFO - [base] [cached since 8419s ago] (1,)
2025-08-04 17:54:11,695 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:54:11,696 - INFO - [base] [cached since 8419s ago] (1, 15)
2025-08-04 17:54:12,765 - INFO - [base] COMMIT
2025-08-04 17:54:12,766 - INFO - [dispatcher] Update id=433007789 is handled. Duration 1078 ms by bot id=7524145939
2025-08-04 17:54:35,148 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:54:35,149 - INFO - [base] BEGIN (implicit)
2025-08-04 17:54:35,149 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:54:35,150 - INFO - [base] [cached since 8455s ago] (1758719447,)
2025-08-04 17:54:35,151 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:54:35,151 - INFO - [base] [cached since 8450s ago] (1,)
2025-08-04 17:54:35,456 - INFO - [base] COMMIT
2025-08-04 17:54:35,457 - INFO - [dispatcher] Update id=433007790 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:54:44,659 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 17:54:44,659 - INFO - [base] BEGIN (implicit)
2025-08-04 17:54:44,660 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:54:44,660 - INFO - [base] [cached since 8464s ago] (1758719447,)
2025-08-04 17:54:44,661 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 17:54:44,661 - INFO - [base] [cached since 8460s ago] (1,)
2025-08-04 17:54:44,948 - INFO - [base] COMMIT
2025-08-04 17:54:44,949 - INFO - [dispatcher] Update id=433007791 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 17:54:46,856 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 17:54:46,856 - INFO - [base] BEGIN (implicit)
2025-08-04 17:54:46,857 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 17:54:46,857 - INFO - [base] [cached since 8464s ago] (1758719447,)
2025-08-04 17:54:46,858 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 17:54:46,858 - INFO - [base] [cached since 8454s ago] (1,)
2025-08-04 17:54:46,860 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 17:54:46,860 - INFO - [base] [cached since 8454s ago] (1, 15)
2025-08-04 17:54:47,229 - INFO - [base] COMMIT
2025-08-04 17:54:47,230 - INFO - [dispatcher] Update id=433007792 is handled. Duration 375 ms by bot id=7524145939
2025-08-04 18:23:57,907 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:23:57,908 - INFO - [base] BEGIN (implicit)
2025-08-04 18:23:57,908 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:23:57,909 - INFO - [base] [cached since 1.022e+04s ago] (1758719447,)
2025-08-04 18:23:57,911 - INFO - [base] ROLLBACK
2025-08-04 18:23:57,911 - ERROR - [handlers] Ошибка в /start: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: отношение "users" не существует
[SQL: SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT]
[parameters: (1758719447,)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-04 18:23:58,723 - INFO - [dispatcher] Update id=433007793 is handled. Duration 813 ms by bot id=7524145939
2025-08-04 18:24:08,812 - INFO - [dispatcher] Polling stopped
2025-08-04 18:24:08,813 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 18:24:08,813 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 18:24:09,000 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:24:13,391 - INFO - [base] select pg_catalog.version()
2025-08-04 18:24:13,391 - INFO - [base] [raw sql] ()
2025-08-04 18:24:13,392 - INFO - [base] select current_schema()
2025-08-04 18:24:13,393 - INFO - [base] [raw sql] ()
2025-08-04 18:24:13,394 - INFO - [base] show standard_conforming_strings
2025-08-04 18:24:13,394 - INFO - [base] [raw sql] ()
2025-08-04 18:24:13,395 - INFO - [base] BEGIN (implicit)
2025-08-04 18:24:13,398 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:24:13,398 - INFO - [base] [generated in 0.00064s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:24:13,400 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:24:13,401 - INFO - [base] [cached since 0.003167s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:24:13,401 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:24:13,402 - INFO - [base] [cached since 0.004229s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:24:13,402 - INFO - [base] COMMIT
2025-08-04 18:24:14,535 - INFO - [dispatcher] Start polling
2025-08-04 18:24:14,803 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:24:15,064 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:24:15,065 - INFO - [base] BEGIN (implicit)
2025-08-04 18:24:15,071 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:24:15,072 - INFO - [base] [generated in 0.00064s] (1758719447,)
2025-08-04 18:24:15,075 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 18:24:15,076 - INFO - [base] [generated in 0.00047s] (1758719447, 'reddmon1', 'reddmon1', None, datetime.datetime(2025, 8, 4, 15, 24, 15, 75269))
2025-08-04 18:24:15,077 - INFO - [base] COMMIT
2025-08-04 18:24:16,158 - INFO - [dispatcher] Update id=433007794 is handled. Duration 1093 ms by bot id=7524145939
2025-08-04 18:26:23,029 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:26:23,030 - INFO - [base] BEGIN (implicit)
2025-08-04 18:26:23,030 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:26:23,031 - INFO - [base] [cached since 128s ago] (1758719447,)
2025-08-04 18:26:23,033 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:26:23,034 - INFO - [base] [generated in 0.00071s] (1,)
2025-08-04 18:26:23,035 - INFO - [base] COMMIT
2025-08-04 18:26:23,385 - INFO - [dispatcher] Update id=433007795 is handled. Duration 360 ms by bot id=7524145939
2025-08-04 18:26:24,849 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:26:24,849 - INFO - [base] BEGIN (implicit)
2025-08-04 18:26:24,850 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:26:24,851 - INFO - [base] [generated in 0.00044s] (1758719447,)
2025-08-04 18:26:24,853 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:26:24,853 - INFO - [base] [generated in 0.00052s] (1,)
2025-08-04 18:26:25,176 - INFO - [base] COMMIT
2025-08-04 18:26:25,177 - INFO - [dispatcher] Update id=433007796 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:30:30,431 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:30:30,432 - INFO - [base] BEGIN (implicit)
2025-08-04 18:30:30,432 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:30:30,433 - INFO - [base] [cached since 375.4s ago] (1758719447,)
2025-08-04 18:30:30,434 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:30:30,434 - INFO - [base] [cached since 247.4s ago] (1,)
2025-08-04 18:30:30,435 - INFO - [base] COMMIT
2025-08-04 18:30:30,736 - INFO - [dispatcher] Update id=433007797 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 18:30:31,798 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:30:31,798 - INFO - [base] BEGIN (implicit)
2025-08-04 18:30:31,798 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:30:31,799 - INFO - [base] [cached since 246.9s ago] (1758719447,)
2025-08-04 18:30:31,800 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:30:31,800 - INFO - [base] [cached since 246.9s ago] (1,)
2025-08-04 18:30:32,083 - INFO - [base] COMMIT
2025-08-04 18:30:32,084 - INFO - [dispatcher] Update id=433007798 is handled. Duration 280 ms by bot id=7524145939
2025-08-04 18:30:35,016 - INFO - [dispatcher] Polling stopped
2025-08-04 18:30:35,016 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 18:30:35,017 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 18:30:35,183 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:30:40,292 - INFO - [base] select pg_catalog.version()
2025-08-04 18:30:40,292 - INFO - [base] [raw sql] ()
2025-08-04 18:30:40,294 - INFO - [base] select current_schema()
2025-08-04 18:30:40,294 - INFO - [base] [raw sql] ()
2025-08-04 18:30:40,295 - INFO - [base] show standard_conforming_strings
2025-08-04 18:30:40,295 - INFO - [base] [raw sql] ()
2025-08-04 18:30:40,296 - INFO - [base] BEGIN (implicit)
2025-08-04 18:30:40,299 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:30:40,300 - INFO - [base] [generated in 0.00059s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:30:40,302 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:30:40,302 - INFO - [base] [cached since 0.003067s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:30:40,303 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:30:40,303 - INFO - [base] [cached since 0.004244s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:30:40,304 - INFO - [base] COMMIT
2025-08-04 18:30:41,439 - INFO - [dispatcher] Start polling
2025-08-04 18:30:41,698 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:30:41,960 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:30:41,961 - INFO - [base] BEGIN (implicit)
2025-08-04 18:30:41,967 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:30:41,968 - INFO - [base] [generated in 0.00058s] (1758719447,)
2025-08-04 18:30:41,971 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:30:41,972 - INFO - [base] [generated in 0.00072s] (1,)
2025-08-04 18:30:41,973 - INFO - [base] COMMIT
2025-08-04 18:30:43,032 - INFO - [dispatcher] Update id=433007799 is handled. Duration 1078 ms by bot id=7524145939
2025-08-04 18:30:44,068 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:30:44,069 - INFO - [base] BEGIN (implicit)
2025-08-04 18:30:44,070 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:30:44,071 - INFO - [base] [generated in 0.00051s] (1758719447,)
2025-08-04 18:30:44,073 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:30:44,073 - INFO - [base] [generated in 0.00043s] (1,)
2025-08-04 18:30:44,075 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT AND bonus_history.date >= $3::TIMESTAMP WITHOUT TIME ZONE
2025-08-04 18:30:44,076 - INFO - [base] [generated in 0.00068s] (1, 0, datetime.datetime(2025, 7, 28, 15, 30, 44, 74398))
2025-08-04 18:30:44,078 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT
2025-08-04 18:30:44,078 - INFO - [base] [generated in 0.00046s] (1, 0)
2025-08-04 18:30:44,364 - INFO - [base] COMMIT
2025-08-04 18:30:44,365 - INFO - [dispatcher] Update id=433007800 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 18:33:24,810 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:33:24,810 - INFO - [base] BEGIN (implicit)
2025-08-04 18:33:24,811 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:33:24,811 - INFO - [base] [cached since 162.8s ago] (1758719447,)
2025-08-04 18:33:24,813 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:33:24,813 - INFO - [base] [cached since 162.8s ago] (1,)
2025-08-04 18:33:24,814 - INFO - [base] COMMIT
2025-08-04 18:33:25,146 - INFO - [dispatcher] Update id=433007801 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:33:47,917 - INFO - [handlers] Обработка /help для пользователя 1758719447
2025-08-04 18:33:48,271 - INFO - [dispatcher] Update id=433007802 is handled. Duration 343 ms by bot id=7524145939
2025-08-04 18:33:49,768 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 18:33:49,768 - INFO - [base] BEGIN (implicit)
2025-08-04 18:33:49,769 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:33:49,769 - INFO - [base] [cached since 187.8s ago] (1758719447,)
2025-08-04 18:33:49,771 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:33:49,771 - INFO - [base] [cached since 187.8s ago] (1,)
2025-08-04 18:33:49,773 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 18:33:49,774 - INFO - [base] [generated in 0.00053s] (1, 15)
2025-08-04 18:33:50,100 - INFO - [base] COMMIT
2025-08-04 18:33:50,101 - INFO - [dispatcher] Update id=433007803 is handled. Duration 343 ms by bot id=7524145939
2025-08-04 18:33:56,638 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:33:56,639 - INFO - [base] BEGIN (implicit)
2025-08-04 18:33:56,639 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:33:56,640 - INFO - [base] [cached since 192.6s ago] (1758719447,)
2025-08-04 18:33:56,641 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:33:56,641 - INFO - [base] [cached since 192.6s ago] (1,)
2025-08-04 18:33:56,642 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT AND bonus_history.date >= $3::TIMESTAMP WITHOUT TIME ZONE
2025-08-04 18:33:56,642 - INFO - [base] [cached since 192.6s ago] (1, 0, datetime.datetime(2025, 7, 28, 15, 33, 56, 641688))
2025-08-04 18:33:56,643 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT
2025-08-04 18:33:56,643 - INFO - [base] [cached since 192.6s ago] (1, 0)
2025-08-04 18:33:56,919 - INFO - [base] COMMIT
2025-08-04 18:33:56,920 - INFO - [dispatcher] Update id=433007804 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 18:34:14,356 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-04 18:34:14,356 - INFO - [base] BEGIN (implicit)
2025-08-04 18:34:14,357 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:34:14,357 - INFO - [base] [cached since 212.4s ago] (7731533840,)
2025-08-04 18:34:14,359 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 18:34:14,359 - INFO - [base] [generated in 0.00048s] (7731533840, 'Неизвестный', '', None, datetime.datetime(2025, 8, 4, 15, 34, 14, 359574))
2025-08-04 18:34:14,361 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-04 18:34:14,361 - INFO - [base] [generated in 0.00042s] ('reddmon1',)
2025-08-04 18:34:14,364 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:34:14,365 - INFO - [base] [cached since 212.4s ago] (1,)
2025-08-04 18:34:14,685 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-08-04 18:34:14,685 - INFO - [base] [generated in 0.00046s] (1, 2)
2025-08-04 18:34:14,687 - INFO - [base] COMMIT
2025-08-04 18:34:14,687 - INFO - [dispatcher] Update id=433007805 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:34:49,262 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:34:49,263 - INFO - [base] BEGIN (implicit)
2025-08-04 18:34:49,263 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:34:49,263 - INFO - [base] [cached since 245.2s ago] (1758719447,)
2025-08-04 18:34:49,264 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:34:49,265 - INFO - [base] [cached since 245.2s ago] (1,)
2025-08-04 18:34:49,266 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT AND bonus_history.date >= $3::TIMESTAMP WITHOUT TIME ZONE
2025-08-04 18:34:49,266 - INFO - [base] [cached since 245.2s ago] (1, 0, datetime.datetime(2025, 7, 28, 15, 34, 49, 266046))
2025-08-04 18:34:49,267 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT
2025-08-04 18:34:49,268 - INFO - [base] [cached since 245.2s ago] (1, 0)
2025-08-04 18:34:49,548 - INFO - [base] COMMIT
2025-08-04 18:34:49,549 - INFO - [dispatcher] Update id=433007806 is handled. Duration 281 ms by bot id=7524145939
2025-08-04 18:34:53,609 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 18:34:53,610 - INFO - [base] BEGIN (implicit)
2025-08-04 18:34:53,610 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:34:53,610 - INFO - [base] [cached since 251.6s ago] (1758719447,)
2025-08-04 18:34:53,612 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:34:53,612 - INFO - [base] [cached since 251.6s ago] (1,)
2025-08-04 18:34:53,613 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 18:34:53,613 - INFO - [base] [cached since 63.84s ago] (1, 15)
2025-08-04 18:34:53,928 - INFO - [base] COMMIT
2025-08-04 18:34:53,929 - INFO - [dispatcher] Update id=433007807 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:35:36,566 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-04 18:35:36,566 - INFO - [base] BEGIN (implicit)
2025-08-04 18:35:36,567 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:35:36,567 - INFO - [base] [cached since 292.5s ago] (1758719447,)
2025-08-04 18:35:36,569 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT
2025-08-04 18:35:36,569 - INFO - [base] [cached since 292.5s ago] (1,)
2025-08-04 18:35:36,570 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT AND bonus_history.date >= $3::TIMESTAMP WITHOUT TIME ZONE
2025-08-04 18:35:36,570 - INFO - [base] [cached since 292.5s ago] (1, 0, datetime.datetime(2025, 7, 28, 15, 35, 36, 570643))
2025-08-04 18:35:36,571 - INFO - [base] SELECT sum(bonus_history.amount) AS sum_1 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT AND bonus_history.amount > $2::BIGINT
2025-08-04 18:35:36,572 - INFO - [base] [cached since 292.5s ago] (1, 0)
2025-08-04 18:35:36,883 - INFO - [base] COMMIT
2025-08-04 18:35:36,884 - INFO - [dispatcher] Update id=433007808 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:35:39,311 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 18:35:39,312 - INFO - [base] BEGIN (implicit)
2025-08-04 18:35:39,312 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:35:39,313 - INFO - [base] [cached since 297.3s ago] (1758719447,)
2025-08-04 18:35:39,314 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:35:39,314 - INFO - [base] [cached since 297.3s ago] (1,)
2025-08-04 18:35:39,315 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 18:35:39,316 - INFO - [base] [cached since 109.5s ago] (1, 15)
2025-08-04 18:35:39,607 - INFO - [base] COMMIT
2025-08-04 18:35:39,608 - INFO - [dispatcher] Update id=433007809 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 18:37:20,647 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:37:20,648 - INFO - [base] BEGIN (implicit)
2025-08-04 18:37:20,648 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:37:20,648 - INFO - [base] [cached since 398.7s ago] (1758719447,)
2025-08-04 18:37:20,650 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:37:20,650 - INFO - [base] [cached since 398.7s ago] (1,)
2025-08-04 18:37:20,651 - INFO - [base] COMMIT
2025-08-04 18:37:20,947 - INFO - [dispatcher] Update id=433007810 is handled. Duration 311 ms by bot id=7524145939
2025-08-04 18:37:24,299 - INFO - [handlers] Обработка /invite для пользователя 1758719447
2025-08-04 18:37:24,299 - INFO - [base] BEGIN (implicit)
2025-08-04 18:37:24,300 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:37:24,300 - INFO - [base] [cached since 402.3s ago] (1758719447,)
2025-08-04 18:37:24,301 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:37:24,301 - INFO - [base] [cached since 402.3s ago] (1,)
2025-08-04 18:37:24,302 - INFO - [base] COMMIT
2025-08-04 18:37:24,596 - INFO - [dispatcher] Update id=433007811 is handled. Duration 296 ms by bot id=7524145939
2025-08-04 18:37:51,505 - INFO - [handlers] Обработка /bonuses для пользователя 7936452658
2025-08-04 18:37:51,505 - INFO - [base] BEGIN (implicit)
2025-08-04 18:37:51,506 - INFO - [base] SELECT users.id 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:37:51,506 - INFO - [base] [cached since 427.4s ago] (7936452658,)
2025-08-04 18:37:51,831 - INFO - [base] COMMIT
2025-08-04 18:37:51,832 - INFO - [dispatcher] Update id=433007812 is handled. Duration 328 ms by bot id=7524145939
2025-08-04 18:37:53,301 - INFO - [handlers] Обработка /start для пользователя 7936452658
2025-08-04 18:37:53,302 - INFO - [base] BEGIN (implicit)
2025-08-04 18:37:53,302 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:37:53,303 - INFO - [base] [cached since 431.3s ago] (7936452658,)
2025-08-04 18:37:53,304 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-04 18:37:53,304 - INFO - [base] [cached since 218.9s ago] (7936452658, 'BaliLove_Johny', 'BaliLoveJohny', None, datetime.datetime(2025, 8, 4, 15, 37, 53, 304426))
2025-08-04 18:37:53,305 - INFO - [base] COMMIT
2025-08-04 18:37:53,699 - INFO - [dispatcher] Update id=433007813 is handled. Duration 405 ms by bot id=7524145939
2025-08-04 18:38:00,757 - INFO - [handlers] Обработка /history для пользователя 1758719447
2025-08-04 18:38:00,758 - INFO - [base] BEGIN (implicit)
2025-08-04 18:38:00,758 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:38:00,758 - INFO - [base] [cached since 438.8s ago] (1758719447,)
2025-08-04 18:38:00,760 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:38:00,760 - INFO - [base] [cached since 438.8s ago] (1,)
2025-08-04 18:38:00,761 - INFO - [base] SELECT bonus_history.id, bonus_history.user_id, bonus_history.amount, bonus_history.operation, bonus_history.description, bonus_history.date 
FROM bonus_history 
WHERE bonus_history.user_id = $1::BIGINT ORDER BY bonus_history.date DESC 
 LIMIT $2::INTEGER
2025-08-04 18:38:00,762 - INFO - [base] [cached since 251s ago] (1, 15)
2025-08-04 18:38:01,066 - INFO - [base] COMMIT
2025-08-04 18:38:01,067 - INFO - [dispatcher] Update id=433007814 is handled. Duration 312 ms by bot id=7524145939
2025-08-04 18:43:31,630 - INFO - [dispatcher] Polling stopped
2025-08-04 18:43:31,631 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-04 18:43:31,631 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 18:43:31,778 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:43:36,149 - INFO - [base] select pg_catalog.version()
2025-08-04 18:43:36,150 - INFO - [base] [raw sql] ()
2025-08-04 18:43:36,151 - INFO - [base] select current_schema()
2025-08-04 18:43:36,151 - INFO - [base] [raw sql] ()
2025-08-04 18:43:36,152 - INFO - [base] show standard_conforming_strings
2025-08-04 18:43:36,153 - INFO - [base] [raw sql] ()
2025-08-04 18:43:36,154 - INFO - [base] BEGIN (implicit)
2025-08-04 18:43:36,156 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:43:36,157 - INFO - [base] [generated in 0.00064s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:43:36,159 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:43:36,159 - INFO - [base] [cached since 0.002988s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:43:36,160 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-04 18:43:36,160 - INFO - [base] [cached since 0.004061s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-04 18:43:36,161 - INFO - [base] COMMIT
2025-08-04 18:43:37,288 - INFO - [dispatcher] Start polling
2025-08-04 18:43:37,545 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-04 18:58:24,106 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-04 18:58:24,107 - INFO - [base] BEGIN (implicit)
2025-08-04 18:58:24,113 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-04 18:58:24,114 - INFO - [base] [generated in 0.00076s] (1758719447,)
2025-08-04 18:58:24,117 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-04 18:58:24,117 - INFO - [base] [generated in 0.00063s] (1,)
2025-08-04 18:58:24,119 - INFO - [base] COMMIT
2025-08-04 18:58:25,178 - INFO - [dispatcher] Update id=433007815 is handled. Duration 1063 ms by bot id=7524145939
2025-08-04 19:00:49,428 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-08-04 19:00:49,436 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-04 19:01:00,562 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-08-14 18:50:29,521 - INFO - [base] select pg_catalog.version()
2025-08-14 18:50:29,522 - INFO - [base] [raw sql] ()
2025-08-14 18:50:29,523 - INFO - [base] select current_schema()
2025-08-14 18:50:29,523 - INFO - [base] [raw sql] ()
2025-08-14 18:50:29,524 - INFO - [base] show standard_conforming_strings
2025-08-14 18:50:29,524 - INFO - [base] [raw sql] ()
2025-08-14 18:50:29,525 - INFO - [base] BEGIN (implicit)
2025-08-14 18:50:29,529 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:50:29,529 - INFO - [base] [generated in 0.00062s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:50:29,531 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:50:29,532 - INFO - [base] [cached since 0.00314s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:50:29,532 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:50:29,533 - INFO - [base] [cached since 0.004304s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:50:29,534 - INFO - [base] COMMIT
2025-08-14 18:50:30,663 - INFO - [dispatcher] Start polling
2025-08-14 18:50:30,918 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 18:55:15,201 - INFO - [dispatcher] Polling stopped
2025-08-14 18:55:15,201 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-14 18:55:15,202 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 18:55:15,348 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 18:55:28,816 - INFO - [base] select pg_catalog.version()
2025-08-14 18:55:28,816 - INFO - [base] [raw sql] ()
2025-08-14 18:55:28,818 - INFO - [base] select current_schema()
2025-08-14 18:55:28,818 - INFO - [base] [raw sql] ()
2025-08-14 18:55:28,819 - INFO - [base] show standard_conforming_strings
2025-08-14 18:55:28,819 - INFO - [base] [raw sql] ()
2025-08-14 18:55:28,821 - INFO - [base] BEGIN (implicit)
2025-08-14 18:55:28,824 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:55:28,825 - INFO - [base] [generated in 0.00062s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:55:28,827 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:55:28,828 - INFO - [base] [cached since 0.003427s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:55:28,828 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 18:55:28,829 - INFO - [base] [cached since 0.004596s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 18:55:28,830 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-08-14 18:55:28,831 - INFO - [base] [no key 0.00088s] ()
2025-08-14 18:55:28,837 - INFO - [base] 
CREATE TABLE purchases (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	name VARCHAR, 
	amount BIGINT, 
	discount_applied INTEGER, 
	bonus_amount BIGINT NOT NULL, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	bonus_paid BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-14 18:55:28,838 - INFO - [base] [no key 0.00094s] ()
2025-08-14 18:55:28,841 - INFO - [base] 
CREATE TABLE bonus_history (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	amount BIGINT, 
	operation VARCHAR, 
	description VARCHAR, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-14 18:55:28,842 - INFO - [base] [no key 0.00087s] ()
2025-08-14 18:55:28,845 - INFO - [base] COMMIT
2025-08-14 18:55:29,977 - INFO - [dispatcher] Start polling
2025-08-14 18:55:30,238 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 18:58:16,929 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-14 18:58:16,930 - INFO - [base] BEGIN (implicit)
2025-08-14 18:58:16,936 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 18:58:16,936 - INFO - [base] [generated in 0.00055s] (1758719447,)
2025-08-14 18:58:16,940 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-14 18:58:16,940 - INFO - [base] [generated in 0.00046s] (1758719447, 'reddmon1', 'reddmon1', None, datetime.datetime(2025, 8, 14, 15, 58, 16, 939975))
2025-08-14 18:58:16,941 - INFO - [base] COMMIT
2025-08-14 18:58:18,002 - INFO - [dispatcher] Update id=433007845 is handled. Duration 1078 ms by bot id=7524145939
2025-08-14 18:58:21,225 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-14 18:58:21,226 - INFO - [base] BEGIN (implicit)
2025-08-14 18:58:21,226 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 18:58:21,226 - INFO - [base] [cached since 4.29s ago] (7731533840,)
2025-08-14 18:58:21,228 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-14 18:58:21,229 - INFO - [base] [cached since 4.288s ago] (7731533840, 'Неизвестный', '', None, datetime.datetime(2025, 8, 14, 15, 58, 21, 228019))
2025-08-14 18:58:21,230 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-14 18:58:21,231 - INFO - [base] [generated in 0.00057s] ('reddmon1',)
2025-08-14 18:58:21,234 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 18:58:21,235 - INFO - [base] [generated in 0.00076s] (1,)
2025-08-14 18:58:21,645 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-08-14 18:58:21,646 - INFO - [base] [generated in 0.00045s] (1, 2)
2025-08-14 18:58:21,647 - INFO - [base] COMMIT
2025-08-14 18:58:21,648 - INFO - [dispatcher] Update id=433007846 is handled. Duration 420 ms by bot id=7524145939
2025-08-14 19:01:27,425 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-14 19:01:27,426 - INFO - [base] BEGIN (implicit)
2025-08-14 19:01:27,426 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:01:27,427 - INFO - [base] [cached since 190.5s ago] (1758719447,)
2025-08-14 19:01:27,427 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 19:01:27,428 - INFO - [base] [cached since 186.2s ago] (1,)
2025-08-14 19:01:27,430 - INFO - [base] UPDATE bonus_history SET status=$1::VARCHAR WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR AND bonus_history.date < $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:01:27,430 - INFO - [base] [generated in 0.00043s] ('available', 1, 'pending', datetime.datetime(2025, 7, 31, 16, 1, 27, 428829))
2025-08-14 19:01:27,432 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:01:27,433 - INFO - [base] [generated in 0.00042s] (0, 1, 'available')
2025-08-14 19:01:27,434 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:01:27,434 - INFO - [base] [cached since 0.002021s ago] (0, 1, 'pending')
2025-08-14 19:01:27,435 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT AND bonus_history.date >= $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:01:27,436 - INFO - [base] [generated in 0.00048s] (0, 1, 0, datetime.datetime(2025, 8, 7, 16, 1, 27, 435832))
2025-08-14 19:01:27,437 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT
2025-08-14 19:01:27,438 - INFO - [base] [generated in 0.00040s] (0, 1, 0)
2025-08-14 19:01:27,438 - INFO - [base] COMMIT
2025-08-14 19:01:27,721 - INFO - [dispatcher] Update id=433007847 is handled. Duration 297 ms by bot id=7524145939
2025-08-14 19:02:39,270 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-08-14 19:02:39,276 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 19:02:50,435 - INFO - [dispatcher] Connection established (tryings = 1, bot id = 7524145939)
2025-08-14 19:07:04,796 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-14 19:07:04,797 - INFO - [base] BEGIN (implicit)
2025-08-14 19:07:04,798 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:07:04,798 - INFO - [base] [cached since 527.9s ago] (1758719447,)
2025-08-14 19:07:04,800 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 19:07:04,800 - INFO - [base] [cached since 523.6s ago] (1,)
2025-08-14 19:07:04,802 - INFO - [base] UPDATE bonus_history SET status=$1::VARCHAR WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR AND bonus_history.date < $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:07:04,802 - INFO - [base] [cached since 337.4s ago] ('available', 1, 'pending', datetime.datetime(2025, 7, 31, 16, 7, 4, 801812))
2025-08-14 19:07:04,803 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:07:04,803 - INFO - [base] [cached since 337.4s ago] (0, 1, 'available')
2025-08-14 19:07:04,805 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:07:04,805 - INFO - [base] [cached since 337.4s ago] (0, 1, 'pending')
2025-08-14 19:07:04,806 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT AND bonus_history.date >= $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:07:04,806 - INFO - [base] [cached since 337.4s ago] (0, 1, 0, datetime.datetime(2025, 8, 7, 16, 7, 4, 805605))
2025-08-14 19:07:04,807 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT
2025-08-14 19:07:04,807 - INFO - [base] [cached since 337.4s ago] (0, 1, 0)
2025-08-14 19:07:04,808 - INFO - [base] COMMIT
2025-08-14 19:07:05,905 - INFO - [dispatcher] Update id=433007848 is handled. Duration 1108 ms by bot id=7524145939
2025-08-14 19:21:12,365 - INFO - [dispatcher] Polling stopped
2025-08-14 19:21:12,365 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-14 19:21:12,366 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 19:21:12,553 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:21:16,086 - INFO - [base] select pg_catalog.version()
2025-08-14 19:21:16,086 - INFO - [base] [raw sql] ()
2025-08-14 19:21:16,087 - INFO - [base] select current_schema()
2025-08-14 19:21:16,088 - INFO - [base] [raw sql] ()
2025-08-14 19:21:16,089 - INFO - [base] show standard_conforming_strings
2025-08-14 19:21:16,089 - INFO - [base] [raw sql] ()
2025-08-14 19:21:16,090 - INFO - [base] BEGIN (implicit)
2025-08-14 19:21:16,093 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:16,094 - INFO - [base] [generated in 0.00064s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:16,096 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:16,097 - INFO - [base] [cached since 0.003627s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:16,098 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:16,098 - INFO - [base] [cached since 0.004881s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:16,099 - INFO - [base] COMMIT
2025-08-14 19:21:17,355 - INFO - [dispatcher] Start polling
2025-08-14 19:21:17,614 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:21:22,043 - INFO - [handlers] Обработка /bonuses для пользователя 1758719447
2025-08-14 19:21:22,044 - INFO - [base] BEGIN (implicit)
2025-08-14 19:21:22,054 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:21:22,055 - INFO - [base] [generated in 0.00070s] (1758719447,)
2025-08-14 19:21:22,059 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 19:21:22,059 - INFO - [base] [generated in 0.00081s] (1,)
2025-08-14 19:21:22,063 - INFO - [base] UPDATE bonus_history SET status=$1::VARCHAR WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR AND bonus_history.date < $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:21:22,063 - INFO - [base] [generated in 0.00051s] ('available', 1, 'pending', datetime.datetime(2025, 7, 31, 16, 21, 22, 61522))
2025-08-14 19:21:22,065 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:21:22,066 - INFO - [base] [generated in 0.00048s] (0, 1, 'available')
2025-08-14 19:21:22,067 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.status = $3::VARCHAR
2025-08-14 19:21:22,068 - INFO - [base] [cached since 0.002615s ago] (0, 1, 'pending')
2025-08-14 19:21:22,071 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT AND bonus_history.date >= $4::TIMESTAMP WITHOUT TIME ZONE
2025-08-14 19:21:22,071 - INFO - [base] [generated in 0.00052s] (0, 1, 0, datetime.datetime(2025, 8, 7, 16, 21, 22, 69495))
2025-08-14 19:21:22,073 - INFO - [base] SELECT coalesce(sum(bonus_history.amount), $1::INTEGER) AS coalesce_1 
FROM bonus_history 
WHERE bonus_history.user_id = $2::BIGINT AND bonus_history.amount > $3::BIGINT
2025-08-14 19:21:22,073 - INFO - [base] [generated in 0.00049s] (0, 1, 0)
2025-08-14 19:21:22,074 - INFO - [base] COMMIT
2025-08-14 19:21:23,134 - INFO - [dispatcher] Update id=433007849 is handled. Duration 1078 ms by bot id=7524145939
2025-08-14 19:21:25,374 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-14 19:21:25,374 - INFO - [base] BEGIN (implicit)
2025-08-14 19:21:25,375 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:21:25,375 - INFO - [base] [cached since 3.321s ago] (1758719447,)
2025-08-14 19:21:25,376 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 19:21:25,377 - INFO - [base] [cached since 3.318s ago] (1,)
2025-08-14 19:21:25,378 - INFO - [base] COMMIT
2025-08-14 19:21:25,708 - INFO - [dispatcher] Update id=433007850 is handled. Duration 327 ms by bot id=7524145939
2025-08-14 19:21:28,638 - INFO - [dispatcher] Polling stopped
2025-08-14 19:21:28,638 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-14 19:21:28,639 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 19:21:28,823 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:21:48,789 - INFO - [base] select pg_catalog.version()
2025-08-14 19:21:48,789 - INFO - [base] [raw sql] ()
2025-08-14 19:21:48,790 - INFO - [base] select current_schema()
2025-08-14 19:21:48,791 - INFO - [base] [raw sql] ()
2025-08-14 19:21:48,792 - INFO - [base] show standard_conforming_strings
2025-08-14 19:21:48,792 - INFO - [base] [raw sql] ()
2025-08-14 19:21:48,793 - INFO - [base] BEGIN (implicit)
2025-08-14 19:21:48,798 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:48,798 - INFO - [base] [generated in 0.00068s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:48,801 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:48,802 - INFO - [base] [cached since 0.003767s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:48,802 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:21:48,803 - INFO - [base] [cached since 0.005287s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:21:48,804 - INFO - [base] 
CREATE TABLE users (
	id BIGSERIAL NOT NULL, 
	telegram_id BIGINT, 
	username VARCHAR, 
	promo_code VARCHAR, 
	invited_by_id BIGINT, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id), 
	UNIQUE (promo_code), 
	FOREIGN KEY(invited_by_id) REFERENCES users (id)
)


2025-08-14 19:21:48,805 - INFO - [base] [no key 0.00090s] ()
2025-08-14 19:21:48,810 - INFO - [base] 
CREATE TABLE purchases (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	name VARCHAR, 
	amount BIGINT, 
	discount_applied INTEGER, 
	bonus_amount BIGINT NOT NULL, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	bonus_paid BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-14 19:21:48,812 - INFO - [base] [no key 0.00118s] ()
2025-08-14 19:21:48,815 - INFO - [base] 
CREATE TABLE bonus_history (
	id BIGSERIAL NOT NULL, 
	user_id BIGINT, 
	amount BIGINT, 
	operation VARCHAR, 
	description VARCHAR, 
	date TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-08-14 19:21:48,816 - INFO - [base] [no key 0.00102s] ()
2025-08-14 19:21:48,819 - INFO - [base] COMMIT
2025-08-14 19:21:49,795 - INFO - [dispatcher] Start polling
2025-08-14 19:21:50,054 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:22:04,337 - INFO - [handlers] Обработка /start для пользователя 1758719447
2025-08-14 19:22:04,338 - INFO - [base] BEGIN (implicit)
2025-08-14 19:22:04,344 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:22:04,345 - INFO - [base] [generated in 0.00053s] (1758719447,)
2025-08-14 19:22:04,348 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-14 19:22:04,348 - INFO - [base] [generated in 0.00045s] (1758719447, 'reddmon1', 'reddmon1', None, datetime.datetime(2025, 8, 14, 16, 22, 4, 348389))
2025-08-14 19:22:04,350 - INFO - [base] COMMIT
2025-08-14 19:22:05,518 - INFO - [dispatcher] Update id=433007851 is handled. Duration 1186 ms by bot id=7524145939
2025-08-14 19:22:19,309 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-14 19:22:19,310 - INFO - [base] BEGIN (implicit)
2025-08-14 19:22:19,310 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:22:19,311 - INFO - [base] [cached since 14.97s ago] (7731533840,)
2025-08-14 19:22:19,312 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-14 19:22:19,312 - INFO - [base] [cached since 14.96s ago] (7731533840, 'Неизвестный', UUID('4e4d4de5-ced7-4605-83ff-86110ec0fb4b'), None, datetime.datetime(2025, 8, 14, 16, 22, 19, 312260))
2025-08-14 19:22:19,314 - INFO - [base] ROLLBACK
2025-08-14 19:22:19,315 - ERROR - [handlers] Ошибка в /start с реферальным кодом: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $3: UUID('4e4d4de5-ced7-4605-83ff-86110ec0fb... (expected str, got UUID)
[SQL: INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id]
[parameters: (7731533840, 'Неизвестный', UUID('4e4d4de5-ced7-4605-83ff-86110ec0fb4b'), None, datetime.datetime(2025, 8, 14, 16, 22, 19, 312260))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-08-14 19:22:19,591 - INFO - [dispatcher] Update id=433007852 is handled. Duration 282 ms by bot id=7524145939
2025-08-14 19:23:55,340 - INFO - [dispatcher] Polling stopped
2025-08-14 19:23:55,341 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-14 19:23:55,341 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 19:23:55,529 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:23:59,348 - INFO - [base] select pg_catalog.version()
2025-08-14 19:23:59,349 - INFO - [base] [raw sql] ()
2025-08-14 19:23:59,350 - INFO - [base] select current_schema()
2025-08-14 19:23:59,350 - INFO - [base] [raw sql] ()
2025-08-14 19:23:59,351 - INFO - [base] show standard_conforming_strings
2025-08-14 19:23:59,351 - INFO - [base] [raw sql] ()
2025-08-14 19:23:59,352 - INFO - [base] BEGIN (implicit)
2025-08-14 19:23:59,356 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:23:59,357 - INFO - [base] [generated in 0.00062s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:23:59,359 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:23:59,360 - INFO - [base] [cached since 0.003711s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:23:59,360 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:23:59,361 - INFO - [base] [cached since 0.00484s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:23:59,362 - INFO - [base] COMMIT
2025-08-14 19:24:00,526 - INFO - [dispatcher] Start polling
2025-08-14 19:24:00,783 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:24:01,046 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-14 19:24:01,047 - INFO - [base] BEGIN (implicit)
2025-08-14 19:24:01,053 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:24:01,053 - INFO - [base] [generated in 0.00050s] (7731533840,)
2025-08-14 19:24:01,055 - INFO - [base] ROLLBACK
2025-08-14 19:24:01,056 - ERROR - [handlers] Ошибка в /start с реферальным кодом: 'UUID' object is not subscriptable
2025-08-14 19:24:02,094 - INFO - [dispatcher] Update id=433007853 is handled. Duration 1047 ms by bot id=7524145939
2025-08-14 19:24:10,644 - INFO - [dispatcher] Polling stopped
2025-08-14 19:24:10,645 - ERROR - [dispatcher] Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-08-14 19:24:10,645 - WARNING - [dispatcher] Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7524145939)
2025-08-14 19:24:10,831 - INFO - [dispatcher] Polling stopped for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:24:14,453 - INFO - [base] select pg_catalog.version()
2025-08-14 19:24:14,454 - INFO - [base] [raw sql] ()
2025-08-14 19:24:14,455 - INFO - [base] select current_schema()
2025-08-14 19:24:14,455 - INFO - [base] [raw sql] ()
2025-08-14 19:24:14,456 - INFO - [base] show standard_conforming_strings
2025-08-14 19:24:14,456 - INFO - [base] [raw sql] ()
2025-08-14 19:24:14,457 - INFO - [base] BEGIN (implicit)
2025-08-14 19:24:14,461 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:24:14,462 - INFO - [base] [generated in 0.00069s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:24:14,464 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:24:14,464 - INFO - [base] [cached since 0.003398s ago] ('purchases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:24:14,465 - INFO - [base] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-08-14 19:24:14,466 - INFO - [base] [cached since 0.004695s ago] ('bonus_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-08-14 19:24:14,466 - INFO - [base] COMMIT
2025-08-14 19:24:15,427 - INFO - [dispatcher] Start polling
2025-08-14 19:24:15,684 - INFO - [dispatcher] Run polling for bot @bali_referal_bot id=7524145939 - 'Referal_Bot'
2025-08-14 19:24:15,945 - INFO - [handlers] Обработка /start с реферальным кодом для пользователя 7731533840
2025-08-14 19:24:15,946 - INFO - [base] BEGIN (implicit)
2025-08-14 19:24:15,952 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.telegram_id = $1::BIGINT
2025-08-14 19:24:15,953 - INFO - [base] [generated in 0.00054s] (7731533840,)
2025-08-14 19:24:15,956 - INFO - [base] INSERT INTO users (telegram_id, username, promo_code, invited_by_id, created_at) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::BIGINT, $5::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id
2025-08-14 19:24:15,956 - INFO - [base] [generated in 0.00043s] (7731533840, 'Неизвестный', '1637cbeb', None, datetime.datetime(2025, 8, 14, 16, 24, 15, 956774))
2025-08-14 19:24:15,958 - INFO - [base] SELECT users.id, users.telegram_id, users.username, users.promo_code, users.invited_by_id, users.created_at 
FROM users 
WHERE users.promo_code = $1::VARCHAR
2025-08-14 19:24:15,959 - INFO - [base] [generated in 0.00052s] ('reddmon1',)
2025-08-14 19:24:15,961 - INFO - [base] SELECT bonus_history.user_id AS bonus_history_user_id, bonus_history.id AS bonus_history_id, bonus_history.amount AS bonus_history_amount, bonus_history.operation AS bonus_history_operation, bonus_history.description AS bonus_history_description, bonus_history.date AS bonus_history_date, bonus_history.status AS bonus_history_status 
FROM bonus_history 
WHERE bonus_history.user_id IN ($1::BIGINT)
2025-08-14 19:24:15,962 - INFO - [base] [generated in 0.00128s] (1,)
2025-08-14 19:24:17,114 - INFO - [base] UPDATE users SET invited_by_id=$1::BIGINT WHERE users.id = $2::BIGINT
2025-08-14 19:24:17,114 - INFO - [base] [generated in 0.00046s] (1, 2)
2025-08-14 19:24:17,115 - INFO - [base] COMMIT
2025-08-14 19:24:17,116 - INFO - [dispatcher] Update id=433007854 is handled. Duration 1172 ms by bot id=7524145939
